<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端进阶梳理</title>
    <meta name="description" content="查缺补漏，厚积薄发">
    <link rel="icon" href="/images/favicon.ico">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/style.css">
    
    <link rel="preload" href="/assets/css/0.styles.17757e47.css" as="style"><link rel="preload" href="/assets/js/app.46fd8109.js" as="script"><link rel="preload" href="/assets/js/2.4e55561f.js" as="script"><link rel="preload" href="/assets/js/107.45cd9d87.js" as="script"><link rel="preload" href="/assets/js/14.376a0de1.js" as="script"><link rel="prefetch" href="/assets/js/10.ff79739d.js"><link rel="prefetch" href="/assets/js/100.dae14178.js"><link rel="prefetch" href="/assets/js/101.783223e3.js"><link rel="prefetch" href="/assets/js/102.7aaf72e8.js"><link rel="prefetch" href="/assets/js/103.7788f966.js"><link rel="prefetch" href="/assets/js/104.a9c36ba3.js"><link rel="prefetch" href="/assets/js/105.6bd5f41f.js"><link rel="prefetch" href="/assets/js/106.c8a06f92.js"><link rel="prefetch" href="/assets/js/108.5f254323.js"><link rel="prefetch" href="/assets/js/109.986207ba.js"><link rel="prefetch" href="/assets/js/11.1b848460.js"><link rel="prefetch" href="/assets/js/110.4f3a7c88.js"><link rel="prefetch" href="/assets/js/111.fc7dc31f.js"><link rel="prefetch" href="/assets/js/112.a537faee.js"><link rel="prefetch" href="/assets/js/113.75e1b03d.js"><link rel="prefetch" href="/assets/js/114.7a6c2080.js"><link rel="prefetch" href="/assets/js/115.262aa39f.js"><link rel="prefetch" href="/assets/js/116.f5fd9d86.js"><link rel="prefetch" href="/assets/js/117.49a03ee9.js"><link rel="prefetch" href="/assets/js/118.df7cde57.js"><link rel="prefetch" href="/assets/js/119.17769ead.js"><link rel="prefetch" href="/assets/js/12.9c504875.js"><link rel="prefetch" href="/assets/js/120.c0d01a5e.js"><link rel="prefetch" href="/assets/js/121.3ee1b241.js"><link rel="prefetch" href="/assets/js/122.c57a4089.js"><link rel="prefetch" href="/assets/js/123.0809c6cc.js"><link rel="prefetch" href="/assets/js/124.57cb2b3b.js"><link rel="prefetch" href="/assets/js/125.3c1e84bb.js"><link rel="prefetch" href="/assets/js/126.34579b53.js"><link rel="prefetch" href="/assets/js/127.9d6555c5.js"><link rel="prefetch" href="/assets/js/128.745108c0.js"><link rel="prefetch" href="/assets/js/129.7e095257.js"><link rel="prefetch" href="/assets/js/13.1df42368.js"><link rel="prefetch" href="/assets/js/130.1d51beed.js"><link rel="prefetch" href="/assets/js/131.cbcc1df7.js"><link rel="prefetch" href="/assets/js/132.4d2c6e77.js"><link rel="prefetch" href="/assets/js/133.1ab052fc.js"><link rel="prefetch" href="/assets/js/134.8683d238.js"><link rel="prefetch" href="/assets/js/135.f53007d8.js"><link rel="prefetch" href="/assets/js/136.865154b6.js"><link rel="prefetch" href="/assets/js/137.5aa5b968.js"><link rel="prefetch" href="/assets/js/138.119789e2.js"><link rel="prefetch" href="/assets/js/139.8aabbed2.js"><link rel="prefetch" href="/assets/js/140.3e71a3f3.js"><link rel="prefetch" href="/assets/js/141.9242f622.js"><link rel="prefetch" href="/assets/js/142.41f89393.js"><link rel="prefetch" href="/assets/js/143.8045598d.js"><link rel="prefetch" href="/assets/js/144.d84469b8.js"><link rel="prefetch" href="/assets/js/145.e8c989a9.js"><link rel="prefetch" href="/assets/js/146.c5f91cc7.js"><link rel="prefetch" href="/assets/js/147.1388284a.js"><link rel="prefetch" href="/assets/js/148.98858ecf.js"><link rel="prefetch" href="/assets/js/149.344d18ba.js"><link rel="prefetch" href="/assets/js/15.d300779d.js"><link rel="prefetch" href="/assets/js/16.8a065148.js"><link rel="prefetch" href="/assets/js/17.fda35c95.js"><link rel="prefetch" href="/assets/js/18.0ec0fae3.js"><link rel="prefetch" href="/assets/js/19.80686a1b.js"><link rel="prefetch" href="/assets/js/20.729705cd.js"><link rel="prefetch" href="/assets/js/21.632ecd56.js"><link rel="prefetch" href="/assets/js/22.93c52e9c.js"><link rel="prefetch" href="/assets/js/23.45c27c98.js"><link rel="prefetch" href="/assets/js/24.c14c009d.js"><link rel="prefetch" href="/assets/js/25.18fc0534.js"><link rel="prefetch" href="/assets/js/26.130126b1.js"><link rel="prefetch" href="/assets/js/27.c1e01341.js"><link rel="prefetch" href="/assets/js/28.40e2e90c.js"><link rel="prefetch" href="/assets/js/29.3759e7de.js"><link rel="prefetch" href="/assets/js/3.6cb4969d.js"><link rel="prefetch" href="/assets/js/30.b2bfa82e.js"><link rel="prefetch" href="/assets/js/31.f08bff36.js"><link rel="prefetch" href="/assets/js/32.43349750.js"><link rel="prefetch" href="/assets/js/33.f9a9b7d1.js"><link rel="prefetch" href="/assets/js/34.e9e1f728.js"><link rel="prefetch" href="/assets/js/35.262f43e7.js"><link rel="prefetch" href="/assets/js/36.5e838a5a.js"><link rel="prefetch" href="/assets/js/37.f2ffbcc8.js"><link rel="prefetch" href="/assets/js/38.30ad561c.js"><link rel="prefetch" href="/assets/js/39.90ad5941.js"><link rel="prefetch" href="/assets/js/4.793bd7b8.js"><link rel="prefetch" href="/assets/js/40.fe5bac46.js"><link rel="prefetch" href="/assets/js/41.ba36c1c0.js"><link rel="prefetch" href="/assets/js/42.1c9059f4.js"><link rel="prefetch" href="/assets/js/43.434ae5e3.js"><link rel="prefetch" href="/assets/js/44.c5a117e3.js"><link rel="prefetch" href="/assets/js/45.33279ba8.js"><link rel="prefetch" href="/assets/js/46.cd3fcb89.js"><link rel="prefetch" href="/assets/js/47.0753e2d9.js"><link rel="prefetch" href="/assets/js/48.a7530acb.js"><link rel="prefetch" href="/assets/js/49.da419a1f.js"><link rel="prefetch" href="/assets/js/5.e11a37c1.js"><link rel="prefetch" href="/assets/js/50.6d0f9ecc.js"><link rel="prefetch" href="/assets/js/51.c8e83524.js"><link rel="prefetch" href="/assets/js/52.ef602911.js"><link rel="prefetch" href="/assets/js/53.6550aa9f.js"><link rel="prefetch" href="/assets/js/54.aa133d0b.js"><link rel="prefetch" href="/assets/js/55.553cdc3d.js"><link rel="prefetch" href="/assets/js/56.3a62701d.js"><link rel="prefetch" href="/assets/js/57.e190aaf9.js"><link rel="prefetch" href="/assets/js/58.a85486af.js"><link rel="prefetch" href="/assets/js/59.48bcf689.js"><link rel="prefetch" href="/assets/js/6.c62f5fc6.js"><link rel="prefetch" href="/assets/js/60.28646c1c.js"><link rel="prefetch" href="/assets/js/61.5a0f5412.js"><link rel="prefetch" href="/assets/js/62.33703e00.js"><link rel="prefetch" href="/assets/js/63.4436ecfc.js"><link rel="prefetch" href="/assets/js/64.0f300fa7.js"><link rel="prefetch" href="/assets/js/65.392d115c.js"><link rel="prefetch" href="/assets/js/66.23ef4ae3.js"><link rel="prefetch" href="/assets/js/67.7bf21110.js"><link rel="prefetch" href="/assets/js/68.bb321ef4.js"><link rel="prefetch" href="/assets/js/69.79e5edb2.js"><link rel="prefetch" href="/assets/js/7.9376e3d7.js"><link rel="prefetch" href="/assets/js/70.65a6d8d8.js"><link rel="prefetch" href="/assets/js/71.7b59cefe.js"><link rel="prefetch" href="/assets/js/72.61d5dbd1.js"><link rel="prefetch" href="/assets/js/73.bf1ddc45.js"><link rel="prefetch" href="/assets/js/74.f800e762.js"><link rel="prefetch" href="/assets/js/75.6372af58.js"><link rel="prefetch" href="/assets/js/76.e7cf9023.js"><link rel="prefetch" href="/assets/js/77.919c0956.js"><link rel="prefetch" href="/assets/js/78.cccda99c.js"><link rel="prefetch" href="/assets/js/79.88409091.js"><link rel="prefetch" href="/assets/js/8.6d4263b8.js"><link rel="prefetch" href="/assets/js/80.ba04ad40.js"><link rel="prefetch" href="/assets/js/81.603ec6ce.js"><link rel="prefetch" href="/assets/js/82.8851030e.js"><link rel="prefetch" href="/assets/js/83.dc3a5c9c.js"><link rel="prefetch" href="/assets/js/84.c4af0fa2.js"><link rel="prefetch" href="/assets/js/85.813d717f.js"><link rel="prefetch" href="/assets/js/86.70bea91f.js"><link rel="prefetch" href="/assets/js/87.03e120e5.js"><link rel="prefetch" href="/assets/js/88.a5bdc300.js"><link rel="prefetch" href="/assets/js/89.ee924672.js"><link rel="prefetch" href="/assets/js/9.e54bac0e.js"><link rel="prefetch" href="/assets/js/90.a5ac6342.js"><link rel="prefetch" href="/assets/js/91.bfdfc313.js"><link rel="prefetch" href="/assets/js/92.1797fe0c.js"><link rel="prefetch" href="/assets/js/93.3106fe2d.js"><link rel="prefetch" href="/assets/js/94.10895deb.js"><link rel="prefetch" href="/assets/js/95.88ece9ff.js"><link rel="prefetch" href="/assets/js/96.da703dd3.js"><link rel="prefetch" href="/assets/js/97.9a7ee943.js"><link rel="prefetch" href="/assets/js/98.5fc23981.js"><link rel="prefetch" href="/assets/js/99.e9f87ec0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.17757e47.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/hello-word.jpg" alt="前端进阶梳理" class="logo"> <span class="site-name can-hide">前端进阶梳理</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/md/resource/resource.html" class="nav-link">资源工具</a></div><div class="nav-item"><a href="/md/introduction/introduction.html" class="nav-link">导读</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Javascript" class="dropdown-title"><span class="title">Javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/js/jsBasic/" class="nav-link router-link-active">JavaScript基础</a></li><li class="dropdown-item"><!----> <a href="/md/js/es6/" class="nav-link">ECMAScript 6</a></li><li class="dropdown-item"><h4>JS书籍</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/js/book/你不知道的javascript上.html" class="nav-link">你不知道的JavaScript(上)</a></li><li class="dropdown-subitem"><a href="/md/js/book/你不知道的javascript中.html" class="nav-link">你不知道的JavaScript(中下)</a></li><li class="dropdown-subitem"><a href="/md/js/book/es6.html" class="nav-link">深入理解ES6</a></li><li class="dropdown-subitem"><a href="/md/js/book/algorithm.html" class="nav-link">JavaScript数据结构和算法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端概括" class="dropdown-title"><span class="title">前端概括</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/webBasics/CSS/" class="nav-link">CSS / HTML</a></li><li class="dropdown-item"><!----> <a href="/md/webBasics/Node/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/md/webBasics/allPath/" class="nav-link">全链路开发</a></li><li class="dropdown-item"><!----> <a href="/md/webBasics/scope/" class="nav-link">领域分支</a></li></ul></div></div><div class="nav-item"><a href="/md/frame/" class="nav-link">框架/库</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="日积月累" class="dropdown-title"><span class="title">日积月累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/codeBlock/module/" class="nav-link">代码模块</a></li><li class="dropdown-item"><!----> <a href="/md/codeBlock/week/" class="nav-link">每周汇总</a></li><li class="dropdown-item"><!----> <a href="/md/codeBlock/jobInterview/" class="nav-link">面试收集</a></li><li class="dropdown-item"><h4>方法论</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/1.html" class="nav-link">编程思想</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/2.html" class="nav-link">开发原则</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/3.html" class="nav-link">开发流程</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/6.html" class="nav-link">代码规范</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/4.html" class="nav-link">设计模式</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/5.html" class="nav-link">开源协议</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/md/about/" class="nav-link">关于我</a></div> <a href="https://github.com/lizheng0515/ignore/issues" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/md/resource/resource.html" class="nav-link">资源工具</a></div><div class="nav-item"><a href="/md/introduction/introduction.html" class="nav-link">导读</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Javascript" class="dropdown-title"><span class="title">Javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/js/jsBasic/" class="nav-link router-link-active">JavaScript基础</a></li><li class="dropdown-item"><!----> <a href="/md/js/es6/" class="nav-link">ECMAScript 6</a></li><li class="dropdown-item"><h4>JS书籍</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/js/book/你不知道的javascript上.html" class="nav-link">你不知道的JavaScript(上)</a></li><li class="dropdown-subitem"><a href="/md/js/book/你不知道的javascript中.html" class="nav-link">你不知道的JavaScript(中下)</a></li><li class="dropdown-subitem"><a href="/md/js/book/es6.html" class="nav-link">深入理解ES6</a></li><li class="dropdown-subitem"><a href="/md/js/book/algorithm.html" class="nav-link">JavaScript数据结构和算法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端概括" class="dropdown-title"><span class="title">前端概括</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/webBasics/CSS/" class="nav-link">CSS / HTML</a></li><li class="dropdown-item"><!----> <a href="/md/webBasics/Node/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/md/webBasics/allPath/" class="nav-link">全链路开发</a></li><li class="dropdown-item"><!----> <a href="/md/webBasics/scope/" class="nav-link">领域分支</a></li></ul></div></div><div class="nav-item"><a href="/md/frame/" class="nav-link">框架/库</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="日积月累" class="dropdown-title"><span class="title">日积月累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/codeBlock/module/" class="nav-link">代码模块</a></li><li class="dropdown-item"><!----> <a href="/md/codeBlock/week/" class="nav-link">每周汇总</a></li><li class="dropdown-item"><!----> <a href="/md/codeBlock/jobInterview/" class="nav-link">面试收集</a></li><li class="dropdown-item"><h4>方法论</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/1.html" class="nav-link">编程思想</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/2.html" class="nav-link">开发原则</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/3.html" class="nav-link">开发流程</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/6.html" class="nav-link">代码规范</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/4.html" class="nav-link">设计模式</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/5.html" class="nav-link">开源协议</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/md/about/" class="nav-link">关于我</a></div> <a href="https://github.com/lizheng0515/ignore/issues" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/md/js/jsBasic/" class="sidebar-link">目录</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础图谱</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/js/jsBasic/js_pic.html" class="sidebar-link">JavaScript图谱</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JS基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/js/jsBasic/小记JavaScript执行机制.html" class="active sidebar-link">1.小记JavaScript执行机制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/md/js/jsBasic/什么是DOM及DOM操作.html" class="sidebar-link">2.小记什么是DOM及DOM操作</a></li><li><a href="/md/js/jsBasic/JavaScript之变量对象.html" class="sidebar-link">3.JavaScript之变量对象</a></li><li><a href="/md/js/jsBasic/JavaScript之闭包.html" class="sidebar-link">4.JavaScript之闭包</a></li><li><a href="/md/js/jsBasic/JavaScript之作用域链.html" class="sidebar-link">5.JavaScript之作用域链</a></li><li><a href="/md/js/jsBasic/JavaScript之从原型到原型链.html" class="sidebar-link">6.JavaScript之从原型到原型链</a></li><li><a href="/md/js/jsBasic/JavaScript之词法作用域和动态作用域.html" class="sidebar-link">7.JavaScript之词法作用域和动态作用域</a></li><li><a href="/md/js/jsBasic/JavaScript之执行上下文栈.html" class="sidebar-link">8.JavaScript之执行上下文栈</a></li><li><a href="/md/js/jsBasic/JavaScript之执行上下文.html" class="sidebar-link">9.JavaScript之执行上下文</a></li><li><a href="/md/js/jsBasic/JavaScript之从ECMAScript规范解读this.html" class="sidebar-link">10.JavaScript之从ECMAScript规范解读this</a></li><li><a href="/md/js/jsBasic/JavaScript之new的实现.html" class="sidebar-link">11.JavaScript之new的实现</a></li><li><a href="/md/js/jsBasic/JavaScript之bind的实现.html" class="sidebar-link">12.JavaScript之bind的实现</a></li><li><a href="/md/js/jsBasic/JavaScript之call和apply的实现.html" class="sidebar-link">13.JavaScript之call和apply的实现</a></li><li><a href="/md/js/jsBasic/JavaScript之类数组对象与arguments.html" class="sidebar-link">14.JavaScript之类数组对象与arguments</a></li><li><a href="/md/js/jsBasic/JavaScript之继承的多种方式.html" class="sidebar-link">15.JavaScript之继承的多种方式</a></li><li><a href="/md/js/jsBasic/JavaScript之创建对象的多种方式.html" class="sidebar-link">16.JavaScript之创建对象的多种方式</a></li><li><a href="/md/js/jsBasic/JavaScript之参数按值传递.html" class="sidebar-link">17.JavaScript之参数按值传递</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><ul><li><h1 id="小记-javascript-执行机制"><a href="#小记-javascript-执行机制" class="header-anchor">#</a> 小记 JavaScript 执行机制</h1> <p>本文的目的就是要保证你彻底弄懂javascript的执行机制，如果读完本文还不懂，可以揍我。</p> <p>不论你是javascript新手还是老鸟，不论是面试求职，还是日常开发工作，我们经常会遇到这样的情况：给定的几行代码，我们需要知道其输出内容和顺序。因为javascript是一门单线程语言，所以我们可以得出结论：</p> <ul><li>javascript是按照语句出现的顺序执行的</li></ul> <p>看到这里读者要打人了：我难道不知道js是一行一行执行的？还用你说？稍安勿躁，正因为js是一行一行执行的，所以我们以为js都是这样的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token string">'2'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然而实际上js是这样的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'定时器开始啦'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'马上执行for循环啦'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        i <span class="token operator">==</span> <span class="token number">99</span> <span class="token operator">&amp;&amp;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行then函数啦'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'代码执行结束'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>依照<strong>js是按照语句出现的顺序执行</strong>这个理念，我自信的写下输出结果：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//&quot;定时器开始啦&quot;</span>
<span class="token comment">//&quot;马上执行for循环啦&quot;</span>
<span class="token comment">//&quot;执行then函数啦&quot;</span>
<span class="token comment">//&quot;代码执行结束&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>去chrome上验证下，结果完全不对，瞬间懵了，说好的一行一行执行的呢？</p> <p>我们真的要彻底弄明白javascript的执行机制了。</p> <h3 id="_1-关于javascript"><a href="#_1-关于javascript" class="header-anchor">#</a> 1.关于javascript</h3> <p>javascript是一门<strong>单线程</strong>语言，在最新的HTML5中提出了Web-Worker，但javascript是单线程这一核心仍未改变。所以一切javascript版的&quot;多线程&quot;都是用单线程模拟出来的，一切javascript多线程都是纸老虎！</p> <h3 id="_2-javascript事件循环"><a href="#_2-javascript事件循环" class="header-anchor">#</a> 2.javascript事件循环</h3> <p>既然js是单线程，那就像只有一个窗口的银行，客户需要排队一个一个办理业务，同理js任务也要一个一个顺序执行。如果一个任务耗时过长，那么后一个任务也必须等着。那么问题来了，假如我们想浏览新闻，但是新闻包含的超清图片加载很慢，难道我们的网页要一直卡着直到图片完全显示出来？因此聪明的程序员将任务分为两类：</p> <ul><li>同步任务</li> <li>异步任务</li></ul> <p>当我们打开网站时，网页的渲染过程就是一大堆同步任务，比如页面骨架和页面元素的渲染。而像加载图片音乐之类占用资源大耗时久的任务，就是异步任务。关于这部分有严格的文字定义，但本文的目的是用最小的学习成本彻底弄懂执行机制，所以我们用导图来说明：</p> <p><img src="https://user-gold-cdn.xitu.io/2017/11/21/15fdd88994142347?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p> <p>导图要表达的内容用文字来表述的话：</p> <ul><li>同步和异步任务分别进入不同的执行&quot;场所&quot;，同步的进入主线程，异步的进入Event Table并注册函数。</li> <li>当指定的事情完成时，Event Table会将这个函数移入Event Queue。</li> <li>主线程内的任务执行完毕为空，会去Event Queue读取对应的函数，进入主线程执行。</li> <li>上述过程会不断重复，也就是常说的Event Loop(事件循环)。</li></ul> <p>我们不禁要问了，那怎么知道主线程执行栈为空啊？js引擎存在monitoring process进程，会持续不断的检查主线程执行栈是否为空，一旦为空，就会去Event Queue那里检查是否有等待被调用的函数。</p> <p>说了这么多文字，不如直接一段代码更直白：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token punctuation">:</span>www<span class="token punctuation">.</span>javascript<span class="token punctuation">.</span>com<span class="token punctuation">,</span>
    data<span class="token punctuation">:</span>data<span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发送成功!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'代码执行结束'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>上面是一段简易的<code>ajax</code>请求代码：</p> <ul><li>ajax进入Event Table，注册回调函数<code>success</code>。</li> <li>执行<code>console.log('代码执行结束')</code>。</li> <li>ajax事件完成，回调函数<code>success</code>进入Event Queue。</li> <li>主线程从Event Queue读取回调函数<code>success</code>并执行。</li></ul> <p>相信通过上面的文字和代码，你已经对js的执行顺序有了初步了解。接下来我们来研究进阶话题：setTimeout。</p> <h3 id="_3-又爱又恨的settimeout"><a href="#_3-又爱又恨的settimeout" class="header-anchor">#</a> 3.又爱又恨的setTimeout</h3> <p>大名鼎鼎的<code>setTimeout</code>无需再多言，大家对他的第一印象就是异步可以延时执行，我们经常这么实现延时3秒执行：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'延时3秒'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>渐渐的<code>setTimeout</code>用的地方多了，问题也出现了，有时候明明写的延时3秒，实际却5，6秒才执行函数，这又咋回事啊？</p> <p>先看一个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行console'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>根据前面我们的结论，<code>setTimeout</code>是异步的，应该先执行<code>console.log</code>这个同步任务，所以我们的结论是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//执行console</span>
<span class="token comment">//task()</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>去验证一下，结果正确！
然后我们修改一下前面的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span>

<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>乍一看其实差不多嘛，但我们把这段代码在chrome执行一下，却发现控制台执行<code>task()</code>需要的时间远远超过3秒，说好的延时三秒，为啥现在需要这么长时间啊？</p> <p>这时候我们需要重新理解<code>setTimeout</code>的定义。我们先说上述代码是怎么执行的：</p> <ul><li><code>task()</code>进入Event Table并注册,计时开始。</li> <li>执行<code>sleep</code>函数，很慢，非常慢，计时仍在继续。</li> <li>3秒到了，计时事件<code>timeout</code>完成，<code>task()</code>进入Event Queue，但是<code>sleep</code>也太慢了吧，还没执行完，只好等着。</li> <li><code>sleep</code>终于执行完了，<code>task()</code>终于从Event Queue进入了主线程执行。</li></ul> <p>上述的流程走完，我们知道<code>setTimeout</code>这个函数，是经过指定时间后，把要执行的任务(本例中为<code>task()</code>)加入到Event Queue中，又因为是单线程任务要一个一个执行，如果前面的任务需要的时间太久，那么只能等着，导致真正的延迟时间远远大于3秒。</p> <p>我们还经常遇到<code>setTimeout(fn,0)</code>这样的代码，0秒后执行又是什么意思呢？是不是可以立即执行呢？</p> <p>答案是不会的，<code>setTimeout(fn,0)</code>的含义是，指定某个任务在主线程最早可得的空闲时间执行，意思就是不用再等多少秒了，只要主线程执行栈内的同步任务全部执行完成，栈为空就马上执行。举例说明：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//代码1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'先执行这里'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行啦'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//代码2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'先执行这里'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'执行啦'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>代码1的输出结果是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//先执行这里</span>
<span class="token comment">//执行啦</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>代码2的输出结果是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//先执行这里</span>
<span class="token comment">// ... 3s later</span>
<span class="token comment">// 执行啦</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>关于<code>setTimeout</code>要补充的是，即便主线程为空，0毫秒实际上也是达不到的。根据HTML的标准，最低是4毫秒。有兴趣的同学可以自行了解。</p> <h3 id="_4-又恨又爱的setinterval"><a href="#_4-又恨又爱的setinterval" class="header-anchor">#</a> 4.又恨又爱的setInterval</h3> <p>上面说完了<code>setTimeout</code>，当然不能错过它的孪生兄弟<code>setInterval</code>。他俩差不多，只不过后者是循环的执行。对于执行顺序来说，<code>setInterval</code>会每隔指定的时间将注册的函数置入Event Queue，如果前面的任务耗时太久，那么同样需要等待。</p> <p>唯一需要注意的一点是，对于<code>setInterval(fn,ms)</code>来说，我们已经知道不是每过<code>ms</code>秒会执行一次<code>fn</code>，而是每过<code>ms</code>秒，会有<code>fn</code>进入Event Queue。一旦<strong>setInterval的回调函数fn执行时间超过了延迟时间ms，那么就完全看不出来有时间间隔了</strong>。这句话请读者仔细品味。</p> <h3 id="_5-promise与process-nexttick-callback"><a href="#_5-promise与process-nexttick-callback" class="header-anchor">#</a> 5.Promise与process.nextTick(callback)</h3> <p>传统的定时器我们已经研究过了，接着我们探究<code>Promise</code>与<code>process.nextTick(callback)</code>的表现。</p> <p><code>Promise</code>的定义和功能本文不再赘述，不了解的读者可以学习一下阮一峰老师的<a href="http://es6.ruanyifeng.com/#docs/promise" target="_blank" rel="noopener noreferrer">Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。而<code>process.nextTick(callback)</code>类似node.js版的&quot;setTimeout&quot;，在事件循环的下一次循环中调用 callback 回调函数。</p> <p>我们进入正题，除了广义的同步任务和异步任务，我们对任务有更精细的定义：</p> <ul><li>macro-task(宏任务)：包括整体代码script，setTimeout，setInterval</li> <li>micro-task(微任务)：Promise，process.nextTick</li></ul> <p>不同类型的任务会进入对应的Event Queue，比如<code>setTimeout</code>和<code>setInterval</code>会进入相同的Event Queue。</p> <p>事件循环的顺序，决定js代码的执行顺序。进入整体代码(宏任务)后，开始第一次循环。接着执行所有的微任务。然后再次从宏任务开始，找到其中一个任务队列执行完毕，再执行所有的微任务。听起来有点绕，我们用文章最开始的一段代码说明：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'then'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'console'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>这段代码作为宏任务，进入主线程。</li> <li>先遇到<code>setTimeout</code>，那么将其回调函数注册后分发到宏任务Event Queue。(注册过程与上同，下文不再描述)</li> <li>接下来遇到了<code>Promise</code>，<code>new Promise</code>立即执行，<code>then</code>函数分发到微任务Event Queue。</li> <li>遇到<code>console.log()</code>，立即执行。</li> <li>好啦，整体代码script作为第一个宏任务执行结束，看看有哪些微任务？我们发现了<code>then</code>在微任务Event Queue里面，执行。</li> <li>ok，第一轮事件循环结束了，我们开始第二轮循环，当然要从宏任务Event Queue开始。我们发现了宏任务Event Queue中<code>setTimeout</code>对应的回调函数，立即执行。</li> <li>结束。</li></ul> <p>事件循环，宏任务，微任务的关系如图所示：</p> <p><img src="https://user-gold-cdn.xitu.io/2017/11/21/15fdcea13361a1ec?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p> <p>我们来分析一段较复杂的代码，看看你是否真的掌握了js的执行机制：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'6'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'8'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'10'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'11'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>第一轮事件循环流程分析如下：</p> <ul><li>整体script作为第一个宏任务进入主线程，遇到<code>console.log</code>，输出1。</li> <li>遇到<code>setTimeout</code>，其回调函数被分发到宏任务Event Queue中。我们暂且记为<code>setTimeout1</code>。</li> <li>遇到<code>process.nextTick()</code>，其回调函数被分发到微任务Event Queue中。我们记为<code>process1</code>。</li> <li>遇到<code>Promise</code>，<code>new Promise</code>直接执行，输出7。<code>then</code>被分发到微任务Event Queue中。我们记为<code>then1</code>。</li> <li>又遇到了<code>setTimeout</code>，其回调函数被分发到宏任务Event Queue中，我们记为<code>setTimeout2</code>。</li></ul> <table><thead><tr><th>宏任务Event Queue</th> <th>微任务Event Queue</th></tr></thead> <tbody><tr><td>setTimeout1</td> <td>process1</td></tr> <tr><td>setTimeout2</td> <td>then1</td></tr></tbody></table> <ul><li>上表是第一轮事件循环宏任务结束时各Event Queue的情况，此时已经输出了1和7。</li> <li>我们发现了<code>process1</code>和<code>then1</code>两个微任务。</li> <li>执行<code>process1</code>,输出6。</li> <li>执行<code>then1</code>，输出8。</li></ul> <p>好了，第一轮事件循环正式结束，这一轮的结果是输出1，7，6，8。那么第二轮时间循环从<code>setTimeout1</code>宏任务开始：</p> <ul><li>首先输出2。接下来遇到了<code>process.nextTick()</code>，同样将其分发到微任务Event Queue中，记为<code>process2</code>。<code>new Promise</code>立即执行输出4，<code>then</code>也分发到微任务Event Queue中，记为<code>then2</code>。</li></ul> <table><thead><tr><th>宏任务Event Queue</th> <th>微任务Event Queue</th></tr></thead> <tbody><tr><td>setTimeout2</td> <td>process2</td></tr> <tr><td></td> <td>then2</td></tr></tbody></table> <ul><li>第二轮事件循环宏任务结束，我们发现有<code>process2</code>和<code>then2</code>两个微任务可以执行。</li> <li>输出3。</li> <li>输出5。</li> <li>第二轮事件循环结束，第二轮输出2，4，3，5。</li> <li>第三轮事件循环开始，此时只剩setTimeout2了，执行。</li> <li>直接输出9。</li> <li>将<code>process.nextTick()</code>分发到微任务Event Queue中。记为<code>process3</code>。</li> <li>直接执行<code>new Promise</code>，输出11。</li> <li>将<code>then</code>分发到微任务Event Queue中，记为<code>then3</code>。</li></ul> <table><thead><tr><th>宏任务Event Queue</th> <th>微任务Event Queue</th></tr></thead> <tbody><tr><td></td> <td>process3</td></tr> <tr><td></td> <td>then3</td></tr></tbody></table> <ul><li>第三轮事件循环宏任务执行结束，执行两个微任务<code>process3</code>和<code>then3</code>。</li> <li>输出10。</li> <li>输出12。</li> <li>第三轮事件循环结束，第三轮输出9，11，10，12。</li></ul> <p>整段代码，共进行了三次事件循环，完整的输出为1，7，6，8，2，4，3，5，9，11，10，12。
(请注意，node环境下的事件监听依赖libuv与前端环境不完全相同，输出顺序可能会有误差)</p> <h3 id="_6-写在最后"><a href="#_6-写在最后" class="header-anchor">#</a> 6.写在最后</h3> <h4 id="_1-js的异步"><a href="#_1-js的异步" class="header-anchor">#</a> (1)js的异步</h4> <p>我们从最开头就说javascript是一门单线程语言，不管是什么新框架新语法糖实现的所谓异步，其实都是用同步的方法去模拟的，牢牢把握住单线程这点非常重要。</p> <h4 id="_2-事件循环event-loop"><a href="#_2-事件循环event-loop" class="header-anchor">#</a> (2)事件循环Event Loop</h4> <p>事件循环是js实现异步的一种方法，也是js的执行机制。</p> <h4 id="_3-javascript的执行和运行"><a href="#_3-javascript的执行和运行" class="header-anchor">#</a> (3)javascript的执行和运行</h4> <p>执行和运行有很大的区别，javascript在不同的环境下，比如node，浏览器，Ringo等等，执行方式是不同的。而运行大多指javascript解析引擎，是统一的。</p> <h4 id="_4-setimmediate"><a href="#_4-setimmediate" class="header-anchor">#</a> (4)setImmediate</h4> <p>微任务和宏任务还有很多种类，比如<code>setImmediate</code>等等，执行都是有共同点的，有兴趣的同学可以自行了解。</p> <h4 id="_5-最后的最后"><a href="#_5-最后的最后" class="header-anchor">#</a> (5)最后的最后</h4> <ul><li>javascript是一门单线程语言</li> <li>Event Loop是javascript的执行机制</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/md/js/jsBasic/js_pic.html" class="prev">JavaScript图谱</a></span> <span class="next"><a href="/md/js/jsBasic/什么是DOM及DOM操作.html">2.小记什么是DOM及DOM操作</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.46fd8109.js" defer></script><script src="/assets/js/2.4e55561f.js" defer></script><script src="/assets/js/107.45cd9d87.js" defer></script><script src="/assets/js/14.376a0de1.js" defer></script>
  </body>
</html>
