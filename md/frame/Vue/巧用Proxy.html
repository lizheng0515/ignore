<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端进阶梳理</title>
    <meta name="description" content="查缺补漏，厚积薄发">
    <link rel="icon" href="/images/favicon.ico">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/style.css">
    
    <link rel="preload" href="/assets/css/0.styles.17757e47.css" as="style"><link rel="preload" href="/assets/js/app.46fd8109.js" as="script"><link rel="preload" href="/assets/js/2.4e55561f.js" as="script"><link rel="preload" href="/assets/js/72.61d5dbd1.js" as="script"><link rel="preload" href="/assets/js/14.376a0de1.js" as="script"><link rel="prefetch" href="/assets/js/10.ff79739d.js"><link rel="prefetch" href="/assets/js/100.dae14178.js"><link rel="prefetch" href="/assets/js/101.783223e3.js"><link rel="prefetch" href="/assets/js/102.7aaf72e8.js"><link rel="prefetch" href="/assets/js/103.7788f966.js"><link rel="prefetch" href="/assets/js/104.a9c36ba3.js"><link rel="prefetch" href="/assets/js/105.6bd5f41f.js"><link rel="prefetch" href="/assets/js/106.c8a06f92.js"><link rel="prefetch" href="/assets/js/107.45cd9d87.js"><link rel="prefetch" href="/assets/js/108.5f254323.js"><link rel="prefetch" href="/assets/js/109.986207ba.js"><link rel="prefetch" href="/assets/js/11.1b848460.js"><link rel="prefetch" href="/assets/js/110.4f3a7c88.js"><link rel="prefetch" href="/assets/js/111.fc7dc31f.js"><link rel="prefetch" href="/assets/js/112.a537faee.js"><link rel="prefetch" href="/assets/js/113.75e1b03d.js"><link rel="prefetch" href="/assets/js/114.7a6c2080.js"><link rel="prefetch" href="/assets/js/115.262aa39f.js"><link rel="prefetch" href="/assets/js/116.f5fd9d86.js"><link rel="prefetch" href="/assets/js/117.49a03ee9.js"><link rel="prefetch" href="/assets/js/118.df7cde57.js"><link rel="prefetch" href="/assets/js/119.17769ead.js"><link rel="prefetch" href="/assets/js/12.9c504875.js"><link rel="prefetch" href="/assets/js/120.c0d01a5e.js"><link rel="prefetch" href="/assets/js/121.3ee1b241.js"><link rel="prefetch" href="/assets/js/122.c57a4089.js"><link rel="prefetch" href="/assets/js/123.0809c6cc.js"><link rel="prefetch" href="/assets/js/124.57cb2b3b.js"><link rel="prefetch" href="/assets/js/125.3c1e84bb.js"><link rel="prefetch" href="/assets/js/126.34579b53.js"><link rel="prefetch" href="/assets/js/127.9d6555c5.js"><link rel="prefetch" href="/assets/js/128.745108c0.js"><link rel="prefetch" href="/assets/js/129.7e095257.js"><link rel="prefetch" href="/assets/js/13.1df42368.js"><link rel="prefetch" href="/assets/js/130.1d51beed.js"><link rel="prefetch" href="/assets/js/131.cbcc1df7.js"><link rel="prefetch" href="/assets/js/132.4d2c6e77.js"><link rel="prefetch" href="/assets/js/133.1ab052fc.js"><link rel="prefetch" href="/assets/js/134.8683d238.js"><link rel="prefetch" href="/assets/js/135.f53007d8.js"><link rel="prefetch" href="/assets/js/136.865154b6.js"><link rel="prefetch" href="/assets/js/137.5aa5b968.js"><link rel="prefetch" href="/assets/js/138.119789e2.js"><link rel="prefetch" href="/assets/js/139.8aabbed2.js"><link rel="prefetch" href="/assets/js/140.3e71a3f3.js"><link rel="prefetch" href="/assets/js/141.9242f622.js"><link rel="prefetch" href="/assets/js/142.41f89393.js"><link rel="prefetch" href="/assets/js/143.8045598d.js"><link rel="prefetch" href="/assets/js/144.d84469b8.js"><link rel="prefetch" href="/assets/js/145.e8c989a9.js"><link rel="prefetch" href="/assets/js/146.c5f91cc7.js"><link rel="prefetch" href="/assets/js/147.1388284a.js"><link rel="prefetch" href="/assets/js/148.98858ecf.js"><link rel="prefetch" href="/assets/js/149.344d18ba.js"><link rel="prefetch" href="/assets/js/15.d300779d.js"><link rel="prefetch" href="/assets/js/16.8a065148.js"><link rel="prefetch" href="/assets/js/17.fda35c95.js"><link rel="prefetch" href="/assets/js/18.0ec0fae3.js"><link rel="prefetch" href="/assets/js/19.80686a1b.js"><link rel="prefetch" href="/assets/js/20.729705cd.js"><link rel="prefetch" href="/assets/js/21.632ecd56.js"><link rel="prefetch" href="/assets/js/22.93c52e9c.js"><link rel="prefetch" href="/assets/js/23.45c27c98.js"><link rel="prefetch" href="/assets/js/24.c14c009d.js"><link rel="prefetch" href="/assets/js/25.18fc0534.js"><link rel="prefetch" href="/assets/js/26.130126b1.js"><link rel="prefetch" href="/assets/js/27.c1e01341.js"><link rel="prefetch" href="/assets/js/28.40e2e90c.js"><link rel="prefetch" href="/assets/js/29.3759e7de.js"><link rel="prefetch" href="/assets/js/3.6cb4969d.js"><link rel="prefetch" href="/assets/js/30.b2bfa82e.js"><link rel="prefetch" href="/assets/js/31.f08bff36.js"><link rel="prefetch" href="/assets/js/32.43349750.js"><link rel="prefetch" href="/assets/js/33.f9a9b7d1.js"><link rel="prefetch" href="/assets/js/34.e9e1f728.js"><link rel="prefetch" href="/assets/js/35.262f43e7.js"><link rel="prefetch" href="/assets/js/36.5e838a5a.js"><link rel="prefetch" href="/assets/js/37.f2ffbcc8.js"><link rel="prefetch" href="/assets/js/38.30ad561c.js"><link rel="prefetch" href="/assets/js/39.90ad5941.js"><link rel="prefetch" href="/assets/js/4.793bd7b8.js"><link rel="prefetch" href="/assets/js/40.fe5bac46.js"><link rel="prefetch" href="/assets/js/41.ba36c1c0.js"><link rel="prefetch" href="/assets/js/42.1c9059f4.js"><link rel="prefetch" href="/assets/js/43.434ae5e3.js"><link rel="prefetch" href="/assets/js/44.c5a117e3.js"><link rel="prefetch" href="/assets/js/45.33279ba8.js"><link rel="prefetch" href="/assets/js/46.cd3fcb89.js"><link rel="prefetch" href="/assets/js/47.0753e2d9.js"><link rel="prefetch" href="/assets/js/48.a7530acb.js"><link rel="prefetch" href="/assets/js/49.da419a1f.js"><link rel="prefetch" href="/assets/js/5.e11a37c1.js"><link rel="prefetch" href="/assets/js/50.6d0f9ecc.js"><link rel="prefetch" href="/assets/js/51.c8e83524.js"><link rel="prefetch" href="/assets/js/52.ef602911.js"><link rel="prefetch" href="/assets/js/53.6550aa9f.js"><link rel="prefetch" href="/assets/js/54.aa133d0b.js"><link rel="prefetch" href="/assets/js/55.553cdc3d.js"><link rel="prefetch" href="/assets/js/56.3a62701d.js"><link rel="prefetch" href="/assets/js/57.e190aaf9.js"><link rel="prefetch" href="/assets/js/58.a85486af.js"><link rel="prefetch" href="/assets/js/59.48bcf689.js"><link rel="prefetch" href="/assets/js/6.c62f5fc6.js"><link rel="prefetch" href="/assets/js/60.28646c1c.js"><link rel="prefetch" href="/assets/js/61.5a0f5412.js"><link rel="prefetch" href="/assets/js/62.33703e00.js"><link rel="prefetch" href="/assets/js/63.4436ecfc.js"><link rel="prefetch" href="/assets/js/64.0f300fa7.js"><link rel="prefetch" href="/assets/js/65.392d115c.js"><link rel="prefetch" href="/assets/js/66.23ef4ae3.js"><link rel="prefetch" href="/assets/js/67.7bf21110.js"><link rel="prefetch" href="/assets/js/68.bb321ef4.js"><link rel="prefetch" href="/assets/js/69.79e5edb2.js"><link rel="prefetch" href="/assets/js/7.9376e3d7.js"><link rel="prefetch" href="/assets/js/70.65a6d8d8.js"><link rel="prefetch" href="/assets/js/71.7b59cefe.js"><link rel="prefetch" href="/assets/js/73.bf1ddc45.js"><link rel="prefetch" href="/assets/js/74.f800e762.js"><link rel="prefetch" href="/assets/js/75.6372af58.js"><link rel="prefetch" href="/assets/js/76.e7cf9023.js"><link rel="prefetch" href="/assets/js/77.919c0956.js"><link rel="prefetch" href="/assets/js/78.cccda99c.js"><link rel="prefetch" href="/assets/js/79.88409091.js"><link rel="prefetch" href="/assets/js/8.6d4263b8.js"><link rel="prefetch" href="/assets/js/80.ba04ad40.js"><link rel="prefetch" href="/assets/js/81.603ec6ce.js"><link rel="prefetch" href="/assets/js/82.8851030e.js"><link rel="prefetch" href="/assets/js/83.dc3a5c9c.js"><link rel="prefetch" href="/assets/js/84.c4af0fa2.js"><link rel="prefetch" href="/assets/js/85.813d717f.js"><link rel="prefetch" href="/assets/js/86.70bea91f.js"><link rel="prefetch" href="/assets/js/87.03e120e5.js"><link rel="prefetch" href="/assets/js/88.a5bdc300.js"><link rel="prefetch" href="/assets/js/89.ee924672.js"><link rel="prefetch" href="/assets/js/9.e54bac0e.js"><link rel="prefetch" href="/assets/js/90.a5ac6342.js"><link rel="prefetch" href="/assets/js/91.bfdfc313.js"><link rel="prefetch" href="/assets/js/92.1797fe0c.js"><link rel="prefetch" href="/assets/js/93.3106fe2d.js"><link rel="prefetch" href="/assets/js/94.10895deb.js"><link rel="prefetch" href="/assets/js/95.88ece9ff.js"><link rel="prefetch" href="/assets/js/96.da703dd3.js"><link rel="prefetch" href="/assets/js/97.9a7ee943.js"><link rel="prefetch" href="/assets/js/98.5fc23981.js"><link rel="prefetch" href="/assets/js/99.e9f87ec0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.17757e47.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/hello-word.jpg" alt="前端进阶梳理" class="logo"> <span class="site-name can-hide">前端进阶梳理</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/md/resource/resource.html" class="nav-link">资源工具</a></div><div class="nav-item"><a href="/md/introduction/introduction.html" class="nav-link">导读</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Javascript" class="dropdown-title"><span class="title">Javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/js/jsBasic/" class="nav-link">JavaScript基础</a></li><li class="dropdown-item"><!----> <a href="/md/js/es6/" class="nav-link">ECMAScript 6</a></li><li class="dropdown-item"><h4>JS书籍</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/js/book/你不知道的javascript上.html" class="nav-link">你不知道的JavaScript(上)</a></li><li class="dropdown-subitem"><a href="/md/js/book/你不知道的javascript中.html" class="nav-link">你不知道的JavaScript(中下)</a></li><li class="dropdown-subitem"><a href="/md/js/book/es6.html" class="nav-link">深入理解ES6</a></li><li class="dropdown-subitem"><a href="/md/js/book/algorithm.html" class="nav-link">JavaScript数据结构和算法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端概括" class="dropdown-title"><span class="title">前端概括</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/webBasics/CSS/" class="nav-link">CSS / HTML</a></li><li class="dropdown-item"><!----> <a href="/md/webBasics/Node/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/md/webBasics/allPath/" class="nav-link">全链路开发</a></li><li class="dropdown-item"><!----> <a href="/md/webBasics/scope/" class="nav-link">领域分支</a></li></ul></div></div><div class="nav-item"><a href="/md/frame/" class="nav-link router-link-active">框架/库</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="日积月累" class="dropdown-title"><span class="title">日积月累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/codeBlock/module/" class="nav-link">代码模块</a></li><li class="dropdown-item"><!----> <a href="/md/codeBlock/week/" class="nav-link">每周汇总</a></li><li class="dropdown-item"><!----> <a href="/md/codeBlock/jobInterview/" class="nav-link">面试收集</a></li><li class="dropdown-item"><h4>方法论</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/1.html" class="nav-link">编程思想</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/2.html" class="nav-link">开发原则</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/3.html" class="nav-link">开发流程</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/6.html" class="nav-link">代码规范</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/4.html" class="nav-link">设计模式</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/5.html" class="nav-link">开源协议</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/md/about/" class="nav-link">关于我</a></div> <a href="https://github.com/lizheng0515/ignore/issues" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/md/resource/resource.html" class="nav-link">资源工具</a></div><div class="nav-item"><a href="/md/introduction/introduction.html" class="nav-link">导读</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Javascript" class="dropdown-title"><span class="title">Javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/js/jsBasic/" class="nav-link">JavaScript基础</a></li><li class="dropdown-item"><!----> <a href="/md/js/es6/" class="nav-link">ECMAScript 6</a></li><li class="dropdown-item"><h4>JS书籍</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/js/book/你不知道的javascript上.html" class="nav-link">你不知道的JavaScript(上)</a></li><li class="dropdown-subitem"><a href="/md/js/book/你不知道的javascript中.html" class="nav-link">你不知道的JavaScript(中下)</a></li><li class="dropdown-subitem"><a href="/md/js/book/es6.html" class="nav-link">深入理解ES6</a></li><li class="dropdown-subitem"><a href="/md/js/book/algorithm.html" class="nav-link">JavaScript数据结构和算法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端概括" class="dropdown-title"><span class="title">前端概括</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/webBasics/CSS/" class="nav-link">CSS / HTML</a></li><li class="dropdown-item"><!----> <a href="/md/webBasics/Node/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/md/webBasics/allPath/" class="nav-link">全链路开发</a></li><li class="dropdown-item"><!----> <a href="/md/webBasics/scope/" class="nav-link">领域分支</a></li></ul></div></div><div class="nav-item"><a href="/md/frame/" class="nav-link router-link-active">框架/库</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="日积月累" class="dropdown-title"><span class="title">日积月累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/codeBlock/module/" class="nav-link">代码模块</a></li><li class="dropdown-item"><!----> <a href="/md/codeBlock/week/" class="nav-link">每周汇总</a></li><li class="dropdown-item"><!----> <a href="/md/codeBlock/jobInterview/" class="nav-link">面试收集</a></li><li class="dropdown-item"><h4>方法论</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/1.html" class="nav-link">编程思想</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/2.html" class="nav-link">开发原则</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/3.html" class="nav-link">开发流程</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/6.html" class="nav-link">代码规范</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/4.html" class="nav-link">设计模式</a></li><li class="dropdown-subitem"><a href="/md/codeBlock/methodology/5.html" class="nav-link">开源协议</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/md/about/" class="nav-link">关于我</a></div> <a href="https://github.com/lizheng0515/ignore/issues" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/md/frame/" class="sidebar-link">目录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue.js</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/frame/Vue/vue.html" class="sidebar-link">1.Vue集合</a></li><li><a href="/md/frame/Vue/巧用Proxy.html" class="active sidebar-link">2.巧用Proxy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#proxy-介绍" class="sidebar-link">Proxy 介绍</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#proxy-用例" class="sidebar-link">Proxy 用例</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#负索引数组" class="sidebar-link">负索引数组</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#隐藏属性" class="sidebar-link">隐藏属性</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#缓存" class="sidebar-link">缓存</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#枚举和只读视图" class="sidebar-link">枚举和只读视图</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#运算符重载" class="sidebar-link">运算符重载</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#cookie对象" class="sidebar-link">cookie对象</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#polyfill" class="sidebar-link">Polyfill</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#为什么要使用-proxy？" class="sidebar-link">为什么要使用 Proxy？</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#proxy-介绍-2" class="sidebar-link">Proxy 介绍</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#proxy-用例-2" class="sidebar-link">Proxy 用例</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#负索引数组-2" class="sidebar-link">负索引数组</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#隐藏属性-2" class="sidebar-link">隐藏属性</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#缓存-2" class="sidebar-link">缓存</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#枚举和只读视图-2" class="sidebar-link">枚举和只读视图</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#运算符重载-2" class="sidebar-link">运算符重载</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#cookie对象-2" class="sidebar-link">cookie对象</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#polyfill-2" class="sidebar-link">Polyfill</a></li><li class="sidebar-sub-header"><a href="/md/frame/Vue/巧用Proxy.html#为什么要使用-proxy？-2" class="sidebar-link">为什么要使用 Proxy？</a></li></ul></li><li><a href="/md/frame/Vue/Vue性能优化.html" class="sidebar-link">3.Vue性能优化</a></li><li><a href="/md/frame/Vue/Vue懒加载.html" class="sidebar-link">4.组件懒加载:Vue Lazy Component介绍</a></li><li><a href="/md/frame/Vue/vuepress.html" class="sidebar-link">5.vuepress集合</a></li><li><a href="/md/frame/Vue/Vue应该知道的几点.html" class="sidebar-link">6.Vue应该知道的几点</a></li><li><a href="/md/frame/Vue/虚拟DOM与DOM-diff.html" class="sidebar-link">7.虚拟DOM与DOM-diff</a></li><li><a href="/md/frame/Vue/Vue123.html" class="sidebar-link">8.Vue源码解析准备</a></li><li><a href="/md/frame/Vue/Vue源码目录.html" class="sidebar-link">9.Vue源码目录</a></li><li><a href="/md/frame/Vue/前端路由简介以及vue-router实现原理.html" class="sidebar-link">10.vue-router实现原理</a></li><li><a href="/md/frame/Vue/Vue双向数据绑定MVVM.html" class="sidebar-link">11.Vue双向数据绑定MVVM</a></li><li><a href="/md/frame/Vue/Vue使用中几个小技巧.html" class="sidebar-link">12.Vue使用中几个小技巧</a></li><li><a href="/md/frame/Vue/Vue梳理.html" class="sidebar-link">13.Vue梳理</a></li><li><a href="/md/frame/Vue/Vue组件汇总.html" class="sidebar-link">14.Vue组件汇总</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Angular</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/frame/Angular/1.html" class="sidebar-link">Angular 学习资料</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>jQuery</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/frame/jQuery/jq-versions.html" class="sidebar-link">jQuery的版本及退出舞台</a></li><li><a href="/md/frame/jQuery/jq-drawing.html" class="sidebar-link">jQuery 谱图</a></li><li><a href="/md/frame/jQuery/jq-extend.html" class="sidebar-link">jQuery extend</a></li><li><a href="/md/frame/jQuery/jquery-skill.html" class="sidebar-link">jQuery小技巧</a></li><li><a href="/md/frame/jQuery/jQuery__插件开发基础.html" class="sidebar-link">jQuery__插件开发基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>类库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/frame/Class/类库汇总.html" class="sidebar-link">插件、工具类库汇总</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><strong>为了保证的可读性，本文采用意译而非直译。</strong></p> <h2 id="proxy-介绍"><a href="#proxy-介绍" class="header-anchor">#</a> Proxy 介绍</h2> <p>使用<code>Proxy</code>，你可以将一只猫伪装成一只老虎。下面大约有6个例子，我希望它们能让你相信，Proxy 提供了强大的 Javascript 元编程。</p> <p>尽管它不像其他ES6功能用的普遍，但<code>Proxy</code>有许多用途，包括<a href="https://hackernoon.com/introducing-javascript-es6-proxies-1327419ab413" target="_blank" rel="noopener noreferrer">运算符重载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<a href="https://en.wikipedia.org/wiki/Mock_object" target="_blank" rel="noopener noreferrer">对象模拟<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<a href="https://medium.com/dailyjs/how-to-use-javascript-proxies-for-fun-and-profit-365579d4a9f8" target="_blank" rel="noopener noreferrer">简洁而灵活的API创建<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<a href="https://github.com/sindresorhus/on-change" target="_blank" rel="noopener noreferrer">对象变化事件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，甚至<a href="https://medium.com/@gustojs/vuejs-3-and-other-top-news-from-q-a-event-with-core-vue-devs-c9834946ae7b" target="_blank" rel="noopener noreferrer">Vue 3背后的内部响应系统提供动力<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p><code>Proxy</code>用于修改某些操作的默认行为，也可以理解为在目标对象之前架设一层拦截，外部所有的访问都必须先通过这层拦截，因此提供了一种机制，可以对外部的访问进行过滤和修改。这个词的原理为代理，在这里可以表示由它来“代理”某些操作，译为“代理器”。</p> <p>ES6原生提供了<code>Proxy</code>构造函数，用来生成<code>Proxy</code>实例。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>Proxy</code>对象的所有用法，都是上面的这种形式。不同的只是<code>handle</code>参数的写法。其中<code>new Proxy</code>用来生成<code>Proxy</code>实例，<code>target</code>是表示所要拦截的对象，<code>handle</code>是用来定制拦截行为的对象。</p> <p>下面是 Proxy 最简单的例子是，这是一个有陷阱的代理，一个<code>get</code>陷阱，总是返回<code>42</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  y<span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> hanler <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">42</span>
<span class="token punctuation">}</span>

target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> hanler<span class="token punctuation">)</span>

target<span class="token punctuation">.</span>x <span class="token comment">//42</span>
target<span class="token punctuation">.</span>y <span class="token comment">//42</span>
target<span class="token punctuation">.</span>x <span class="token comment">// 42</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>结果是一个对象将为任何属性访问操作都返回“42”。 这包括<code>target.x</code>，<code>target['x']</code>，<code>Reflect.get(target, 'x')</code>等。</p> <p>但是，Proxy 陷阱当然不限于属性的读取。 它只是十几个不同陷阱中的一个：</p> <ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/get" target="_blank" rel="noopener noreferrer">handler.get<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/set" target="_blank" rel="noopener noreferrer">handler.set<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/has" target="_blank" rel="noopener noreferrer">handler.has<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/apply" target="_blank" rel="noopener noreferrer">handler.apply<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/construct" target="_blank" rel="noopener noreferrer">handler.construct<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/ownKeys" target="_blank" rel="noopener noreferrer">handler.ownKeys<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/deleteProperty" target="_blank" rel="noopener noreferrer">handler.deleteProperty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/defineProperty" target="_blank" rel="noopener noreferrer">handler.defineProperty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/isExtensible" target="_blank" rel="noopener noreferrer">handler.isExtensible<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/preventExtensions" target="_blank" rel="noopener noreferrer">handler.preventExtensions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getPrototypeOf" target="_blank" rel="noopener noreferrer">handler.getPrototypeOf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/setPrototypeOf" target="_blank" rel="noopener noreferrer">handler.setPrototypeOf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getOwnPropertyDescriptor" target="_blank" rel="noopener noreferrer">handler.getOwnPropertyDescriptor<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="proxy-用例"><a href="#proxy-用例" class="header-anchor">#</a> Proxy 用例</h2> <p><img src="https://image-static.segmentfault.com/881/960/881960086-5d24471f89a11_articlex" alt="img"></p> <h4 id="默认值-“零值”"><a href="#默认值-“零值”" class="header-anchor">#</a> <strong>默认值/“零值”</strong></h4> <p>在 Go 语言中，有<a href="https://tour.golang.org/basics/12" target="_blank" rel="noopener noreferrer">零值<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的概念，零值是特定于类型的隐式默认结构值。其思想是提供类型安全的默认基元值，或者用gopher的话说，给结构一个有用的零值。</p> <p>虽然不同的创建模式支持类似的功能，但Javascript无法用隐式初始值包装对象。Javascript中未设置属性的默认值是<code>undefined</code>。但 Proxy 可以改变这种情况。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">withZeroValue</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> zeroValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>prop <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token operator">?</span> obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token punctuation">:</span> zeroValue
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>函数<code>withZeroValue</code> 用来包装目标对象。 如果设置了属性，则返回属性值。 否则，它返回一个默认的**“零值”**。</p> <p>从技术上讲，这种方法也不是隐含的，但如果我们扩展<code>withZeroValue</code>，以Boolean (<code>false</code>), Number (<code>0</code>), String (<code>&quot;&quot;</code>), Object (<code>{}</code>)，Array (<code>[]</code>)等对应的零值，则可能是隐含的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> pos <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  y<span class="token punctuation">:</span> <span class="token number">19</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token comment">// 4, 19, undefined</span>

pos <span class="token operator">=</span> <span class="token function">withZeroValue</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token comment">// 4, 19, 0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>此功能可能有用的一个地方是坐标系。 绘图库可以基于数据的形状自动支持2D和3D渲染。 不是创建两个单独的模型，而是始终将<code>z</code>默认为 <code>0</code> 而不是<code>undefined</code>，这可能是有意义的。</p> <h2 id="负索引数组"><a href="#负索引数组" class="header-anchor">#</a> 负索引数组</h2> <p>在JS中获取数组中的最后一个元素方式通过写的很冗长且重复，也容易出错。 这就是为什么有一个TC39提案定义了一个便利属性<code>Array.lastItem</code>来获取和设置最后一个元素。</p> <p>其他语言，如Python和Ruby，使用负组索引更容易访问最后面的元素。例如，可以简单地使用<code>arr[-1]</code>替代<code>arr[arr.length-1]</code>访问最后一个元素。</p> <p>使用 Proxy 也可以在 Javascript 中使用负索引。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">negativeArray</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">els</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>els<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> propKey<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token operator">+</span>propKey <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">String</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token operator">+</span>propKey<span class="token punctuation">)</span> <span class="token punctuation">:</span> propKey<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>一个重要的注意事项是包含<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/get" target="_blank" rel="noopener noreferrer">handler.get<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的陷阱字符串化所有属性。 对于数组访问，我们需要将属性名称强制转换为<code>Numbers</code>，这样就可以使用一元加运算符简洁地完成。</p> <p>现在<code>[-1]</code>访问最后一个元素，<code>[-2]</code>访问倒数第二个元素，以此类推。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> unicorn <span class="token operator">=</span> <span class="token function">negativeArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'🐴'</span><span class="token punctuation">,</span> <span class="token string">'🎂'</span><span class="token punctuation">,</span> <span class="token string">'🌈'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

unicorn<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// '🌈'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="隐藏属性"><a href="#隐藏属性" class="header-anchor">#</a> 隐藏属性</h2> <p>众所周知 JS 没有私有属性。 <code>Symbol</code>最初是为了<a href="https://codeburst.io/a-practical-guide-to-es6-symbol-3fc90117c7ac" target="_blank" rel="noopener noreferrer">启用私有属性而引入的<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，但后来使用像<code>Object.getOwnPropertySymbols</code>这样的反射方法进行了淡化，这使得它们可以被公开发现。</p> <p>长期以来的惯例是将私有属性命名为前下划线<code>_</code>，有效地标记它们“不要访问”。<code>Prox</code> 提供了一种稍微更好的方法来屏蔽这些属性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> hide <span class="token operator">=</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">'_'</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">has</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">!</span>prop<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> prop <span class="token keyword">in</span> obj<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">ownKeys</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">prop</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> prop <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">||</span> <span class="token operator">!</span>prop<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> rec</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>prop <span class="token keyword">in</span> rec<span class="token punctuation">)</span> <span class="token operator">?</span> obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>hide</code>函数包装目标对象，并使得从<code>in</code>运算符和<code>Object.getOwnPropertyNames</code>等方法无法访问带有下划线的属性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> userData <span class="token operator">=</span> <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  firstName<span class="token punctuation">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span>
  mediumHandle<span class="token punctuation">:</span> <span class="token string">'@tbarrasso'</span><span class="token punctuation">,</span>
  _favoriteRapper<span class="token punctuation">:</span> <span class="token string">'Drake'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

userData<span class="token punctuation">.</span>_favoriteRapper        <span class="token comment">// undefined</span>
<span class="token punctuation">(</span><span class="token string">'_favoriteRapper'</span> <span class="token keyword">in</span> userData<span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>更完整的实现还包括诸如<code>deleteProperty</code>和<code>defineProperty</code>之类的陷阱。 除了闭包之外，这可能是最接近真正私有属性的方法，因为它们无法通过枚举，克隆，访问或修改来访问。</p> <p><img src="https://image-static.segmentfault.com/234/790/2347900426-5d24b42d28446_articlex" alt="img"></p> <p>但是，它们在开发控制台中可见。 只有闭包才能免于这种命运。</p> <h2 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h2> <p>在客户端和服务器之间同步状态时遇到困难并不罕见。数据可能会随着时间的推移而发生变化，很难确切地知道何时重新同步的逻辑。</p> <p><code>Proxy</code>启用了一种新方法：根据需要将对象包装为无效（和重新同步）属性。 所有访问属性的尝试都首先检查缓存策略，该策略决定返回当前在内存中的内容还是采取其他一些操作。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">ephemeral</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> ttl <span class="token operator">=</span> <span class="token number">60</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token constant">CREATED_AT</span> <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">isExpired</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token constant">CREATED_AT</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>ttl <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">isExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token punctuation">:</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这个函数过于简化了:它使对象上的所有属性在一段时间后都无法访问。然而，将此方法扩展为根据每个属性设置生存时间(TTL)，并在一定的持续时间或访问次数之后更新它并不困难。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> bankAccount <span class="token operator">=</span> <span class="token function">ephemeral</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  balance<span class="token punctuation">:</span> <span class="token number">14.93</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bankAccount<span class="token punctuation">.</span>balance<span class="token punctuation">)</span>    <span class="token comment">// 14.93</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bankAccount<span class="token punctuation">.</span>balance<span class="token punctuation">)</span>  <span class="token comment">// undefined</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这个示例简单地使银行帐户余额在10秒后无法访问。</p> <h2 id="枚举和只读视图"><a href="#枚举和只读视图" class="header-anchor">#</a> 枚举和只读视图</h2> <p>这些例子来自<code>Csaba Hellinge 关于[代理用例][23]和[Mozilla黑客][24]的文章。方法是包装一个对象以防止扩展或修改。虽然</code>object.freeze`现在提供了将对象渲染为只读的功能，但是可以对这种方法进行扩展，以便访问不存在属性的枚举对象能更好地处理抛出错误。</p> <h4 id="只读视图"><a href="#只读视图" class="header-anchor">#</a> <strong>只读视图</strong></h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">NOPE</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Can't modify read-only view&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token constant">NOPE_HANDLER</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token constant">NOPE</span><span class="token punctuation">,</span>
  defineProperty<span class="token punctuation">:</span> <span class="token constant">NOPE</span><span class="token punctuation">,</span>
  deleteProperty<span class="token punctuation">:</span> <span class="token constant">NOPE</span><span class="token punctuation">,</span>
  preventExtensions<span class="token punctuation">:</span> <span class="token constant">NOPE</span><span class="token punctuation">,</span>
  setPrototypeOf<span class="token punctuation">:</span> <span class="token constant">NOPE</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">readOnlyView</span> <span class="token operator">=</span> <span class="token parameter">target</span> <span class="token operator">=&gt;</span>
  <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token constant">NOPE_HANDLER</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="枚举视图"><a href="#枚举视图" class="header-anchor">#</a> <strong>枚举视图</strong></h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">createEnum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">readOnlyView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Unknown prop &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prop<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>现在我们可以创建一个<code>Object</code>，如果尝试访问不存在的属性现在不是返回<code>undefined</code>，而是会抛出异常。 这使得在早期捕获和解决问题变得更加容易。</p> <p>我们的<code>enum</code>示例也是代理上的代理的第一个示例，它确认代理是另一个代理的有效目标对象。这通过组合代理功能促进了代码重用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token constant">SHIRT_SIZES</span> <span class="token operator">=</span> <span class="token function">createEnum</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token constant">S</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token constant">M</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
  <span class="token constant">L</span><span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token constant">SHIRT_SIZES</span><span class="token punctuation">.</span><span class="token constant">S</span> <span class="token comment">// 10</span>
<span class="token constant">SHIRT_SIZES</span><span class="token punctuation">.</span><span class="token constant">S</span> <span class="token operator">=</span> <span class="token number">15</span>

<span class="token comment">// Uncaught Error: Can't modify read-only view</span>

<span class="token constant">SHIRT_SIZES</span><span class="token punctuation">.</span><span class="token constant">XL</span>

<span class="token comment">// Uncaught ReferenceError: Unknown prop &quot;XL&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这种方法可以进一步扩展，包括模拟方法<code>nameOf</code>，它返回给定<code>enum</code>值的属性名，模仿Javascript等语言中的行为。</p> <p>虽然其他框架和语言超集(比如TypeScript)提供<code>enum</code>类型，但是这个解决方案的独特之处在于，它使用普通Javascript，而不使用特殊的构建工具或转置器。</p> <h2 id="运算符重载"><a href="#运算符重载" class="header-anchor">#</a> 运算符重载</h2> <p>也许从语法上讲，最吸引人的 <code>Proxy</code> 用例是重载操作符的能力，比如使用<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/has" target="_blank" rel="noopener noreferrer">handler.has<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/in" target="_blank" rel="noopener noreferrer">in<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>操作符。</p> <p><code>in</code>操作符用于检查指定的属性是否位于指定的对象或其原型链中。但它也是语法上最优雅的重载操作符。这个例子定义了一个连续<code>range</code>函数来比较数字。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">range</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">has</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">+</span>prop <span class="token operator">&gt;=</span> min <span class="token operator">&amp;&amp;</span> <span class="token operator">+</span>prop <span class="token operator">&lt;=</span> max<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>与Python不同，Python使用生成器与有限的整数序列进行比较，这种方法支持十进制比较，可以扩展为支持其他数值范围。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">X</span> <span class="token operator">=</span> <span class="token number">10.5</span>
<span class="token keyword">const</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token constant">X</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">X</span> <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// true</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

nums<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> n <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 5]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>尽管这个用例不能解决复杂的问题，但它确实提供了干净、可读和可重用的代码。</p> <p>除了<code>in</code>运算符，我们还可以重载<code>delete</code>和<code>new</code>。</p> <h2 id="cookie对象"><a href="#cookie对象" class="header-anchor">#</a> cookie对象</h2> <p>如果你曾经与<code>cookie</code>进行交互，那么必须处理<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie" target="_blank" rel="noopener noreferrer">document.cookie<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 这是一个不寻常的API，因为API是一个<code>String</code>，它读出所有<code>cookie</code>，以<strong>分号分隔</strong>。</p> <p><code>document.cookie</code>是一个看起来像这样的字符串：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>_octo<span class="token operator">=</span><span class="token constant">GH1</span><span class="token number">.2</span><span class="token number">.2591</span><span class="token number">.47507</span><span class="token punctuation">;</span> _ga<span class="token operator">=</span><span class="token constant">GA1</span><span class="token number">.1</span><span class="token number">.62208</span><span class="token number">.4087</span><span class="token punctuation">;</span> has_recent_activity<span class="token operator">=</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>简而言之，处理<code>document.cookie</code>比较麻烦且容易出错。 一种方法是使用<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie/Simple_document.cookie_framework" target="_blank" rel="noopener noreferrer">简单的cookie框架<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，可以适用于使用 Proxy。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getCookieObject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cookies <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cks<span class="token punctuation">,</span> ck</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">[</span>ck<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> ck<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span> ck<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>ck<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>cks<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">setCookie</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">deleteCookie</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=; expires=Thu, 01 Jan 1970 00:00:01 GMT;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>cookies<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token function">setCookie</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">,</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function-variable function">deleteProperty</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token function">deleteCookie</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">,</span> Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>此函数返回一个键值对对象，但代理对<code>document.cookie</code>进行持久性的所有更改。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> docCookies <span class="token operator">=</span> <span class="token function">getCookieObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

docCookies<span class="token punctuation">.</span>has_recent_activity              <span class="token comment">// &quot;1&quot;</span>
docCookies<span class="token punctuation">.</span>has_recent_activity <span class="token operator">=</span> <span class="token string">&quot;2&quot;</span>        <span class="token comment">// &quot;2&quot;</span>
<span class="token keyword">delete</span> docCookies2<span class="token punctuation">[</span><span class="token string">&quot;has_recent_activity&quot;</span><span class="token punctuation">]</span>   <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在11行代码中，修改<code>cookie</code>提供了更好的交互，尽管在生产环境中还需要诸如字符串规范化之类的附加功能。</p> <p>细节决定成败，Proxy 也不例外。</p> <h2 id="polyfill"><a href="#polyfill" class="header-anchor">#</a> Polyfill</h2> <p>在撰写本文时(2019年5月)，Proxy 没有<strong>完整的 polyfill</strong>。然而，有一个由谷歌编写的 <a href="https://github.com/GoogleChrome/proxy-polyfill" target="_blank" rel="noopener noreferrer">partial polyfill for Proxy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，它支持<code>get</code>、<code>set</code>、<code>apply</code>和<code>construct trap</code>，并适用于IE9+。</p> <h4 id="它是-proxy-吗？"><a href="#它是-proxy-吗？" class="header-anchor">#</a> 它是 Proxy 吗？</h4> <blockquote><p>确定一个对象是否是代理是不可能的</p></blockquote> <p>根据Javascript语言规范，无法确定对象是否是代理。 但是，在 Node 10+上，可以使用<a href="https://nodejs.org/api/util.html#util_util_types_isproxy_value" target="_blank" rel="noopener noreferrer">util.types.isProxy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>方法。</p> <h4 id="目标是什么？"><a href="#目标是什么？" class="header-anchor">#</a> 目标是什么？</h4> <p>给定一个代理对象，就不可能获得或更改目标对象。也不可能获取或修改处理程序对象。</p> <p>最近似的是Ben Nadel的文章<a href="https://www.bennadel.com/blog/3262-using-proxy-objects-to-dynamically-change-the-this-binding-within-a-generator-in-node-js.htm" target="_blank" rel="noopener noreferrer">Using Proxy to Dynamically Change THIS Binding<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，它使用一个空对象作为<code>Proxy</code>目标和闭包来巧妙地重新分配对象的<code>Proxy</code>操作。</p> <h4 id="proxy-原语"><a href="#proxy-原语" class="header-anchor">#</a> Proxy 原语</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token string">&quot;To be, or not to be...&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// TypeError: Cannot create proxy with a non-object as target or handler</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>不幸的是，Proxy的一个限制是目标必须是Object。 这意味着我们不能直接使用像String这样的原语。 😞</p> <h4 id="性能"><a href="#性能" class="header-anchor">#</a> 性能</h4> <p>Proxy的一个主要缺点是性能。 因浏览器和使用而异，但是对于性能有要求的代码来说，代理不是最好的方法。 当然，可以衡量影响并确定代理的优势是否超过对性能的影响。</p> <h2 id="为什么要使用-proxy？"><a href="#为什么要使用-proxy？" class="header-anchor">#</a> 为什么要使用 Proxy？</h2> <p>Proxy 提供虚拟化接口来控制任何目标 Object的行为。 这样做可以在简单性和实用性之间取得平衡，而不会牺牲兼容性。</p> <p>也许使用<code>Proxy</code>的最令人信服的理由是，上面的许多示例只有几行，并且可以轻松组合以创建复杂的功能。 最后一个例子，我们可以从几个用例中组合函数来创建一个只读<code>cookie</code>对象，该对象返回不存在或“私有”隐藏cookie的默认值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// document.cookie = &quot;_octo=GH1.2.2591.47507; _ga=GA1.1.62208.4087; has_recent_activity=1&quot;</span>

<span class="token keyword">let</span> docCookies <span class="token operator">=</span> <span class="token function">withZeroValue</span><span class="token punctuation">(</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token function">readOnlyView</span><span class="token punctuation">(</span><span class="token function">getCookieObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Cookie not found&quot;</span><span class="token punctuation">)</span>

docCookies<span class="token punctuation">.</span>has_recent_activity  <span class="token comment">// &quot;1&quot;</span>
docCookies<span class="token punctuation">.</span>nonExistentCookie    <span class="token comment">// &quot;Cookie not found&quot;</span>
docCookies<span class="token punctuation">.</span>_ga                  <span class="token comment">// &quot;Cookie not found&quot;</span>
docCookies<span class="token punctuation">.</span>newCookie <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span>      <span class="token comment">// Uncaught Error: Can't modify read-only view</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>我希望这些例子已经表明，对于Javascript中的小众元编程来说，代理不仅仅是一个深奥的特性。<strong>为了保证的可读性，本文采用意译而非直译。</strong></p> <h2 id="proxy-介绍-2"><a href="#proxy-介绍-2" class="header-anchor">#</a> Proxy 介绍</h2> <p>使用<code>Proxy</code>，你可以将一只猫伪装成一只老虎。下面大约有6个例子，我希望它们能让你相信，Proxy 提供了强大的 Javascript 元编程。</p> <p>尽管它不像其他ES6功能用的普遍，但<code>Proxy</code>有许多用途，包括<a href="https://hackernoon.com/introducing-javascript-es6-proxies-1327419ab413" target="_blank" rel="noopener noreferrer">运算符重载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<a href="https://en.wikipedia.org/wiki/Mock_object" target="_blank" rel="noopener noreferrer">对象模拟<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<a href="https://medium.com/dailyjs/how-to-use-javascript-proxies-for-fun-and-profit-365579d4a9f8" target="_blank" rel="noopener noreferrer">简洁而灵活的API创建<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<a href="https://github.com/sindresorhus/on-change" target="_blank" rel="noopener noreferrer">对象变化事件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，甚至<a href="https://medium.com/@gustojs/vuejs-3-and-other-top-news-from-q-a-event-with-core-vue-devs-c9834946ae7b" target="_blank" rel="noopener noreferrer">Vue 3背后的内部响应系统提供动力<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p><code>Proxy</code>用于修改某些操作的默认行为，也可以理解为在目标对象之前架设一层拦截，外部所有的访问都必须先通过这层拦截，因此提供了一种机制，可以对外部的访问进行过滤和修改。这个词的原理为代理，在这里可以表示由它来“代理”某些操作，译为“代理器”。</p> <p>ES6原生提供了<code>Proxy</code>构造函数，用来生成<code>Proxy</code>实例。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>Proxy</code>对象的所有用法，都是上面的这种形式。不同的只是<code>handle</code>参数的写法。其中<code>new Proxy</code>用来生成<code>Proxy</code>实例，<code>target</code>是表示所要拦截的对象，<code>handle</code>是用来定制拦截行为的对象。</p> <p>下面是 Proxy 最简单的例子是，这是一个有陷阱的代理，一个<code>get</code>陷阱，总是返回<code>42</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  y<span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> hanler <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">42</span>
<span class="token punctuation">}</span>

target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> hanler<span class="token punctuation">)</span>

target<span class="token punctuation">.</span>x <span class="token comment">//42</span>
target<span class="token punctuation">.</span>y <span class="token comment">//42</span>
target<span class="token punctuation">.</span>x <span class="token comment">// 42</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>结果是一个对象将为任何属性访问操作都返回“42”。 这包括<code>target.x</code>，<code>target['x']</code>，<code>Reflect.get(target, 'x')</code>等。</p> <p>但是，Proxy 陷阱当然不限于属性的读取。 它只是十几个不同陷阱中的一个：</p> <ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/get" target="_blank" rel="noopener noreferrer">handler.get<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/set" target="_blank" rel="noopener noreferrer">handler.set<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/has" target="_blank" rel="noopener noreferrer">handler.has<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/apply" target="_blank" rel="noopener noreferrer">handler.apply<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/construct" target="_blank" rel="noopener noreferrer">handler.construct<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/ownKeys" target="_blank" rel="noopener noreferrer">handler.ownKeys<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/deleteProperty" target="_blank" rel="noopener noreferrer">handler.deleteProperty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/defineProperty" target="_blank" rel="noopener noreferrer">handler.defineProperty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/isExtensible" target="_blank" rel="noopener noreferrer">handler.isExtensible<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/preventExtensions" target="_blank" rel="noopener noreferrer">handler.preventExtensions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getPrototypeOf" target="_blank" rel="noopener noreferrer">handler.getPrototypeOf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/setPrototypeOf" target="_blank" rel="noopener noreferrer">handler.setPrototypeOf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getOwnPropertyDescriptor" target="_blank" rel="noopener noreferrer">handler.getOwnPropertyDescriptor<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="proxy-用例-2"><a href="#proxy-用例-2" class="header-anchor">#</a> Proxy 用例</h2> <p><img src="https://segmentfault.com/img/bVbuRz3?w=697&amp;h=344" alt="clipboard.png"></p> <h4 id="默认值-“零值”-2"><a href="#默认值-“零值”-2" class="header-anchor">#</a> <strong>默认值/“零值”</strong></h4> <p>在 Go 语言中，有<a href="https://tour.golang.org/basics/12" target="_blank" rel="noopener noreferrer">零值<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的概念，零值是特定于类型的隐式默认结构值。其思想是提供类型安全的默认基元值，或者用gopher的话说，给结构一个有用的零值。</p> <p>虽然不同的创建模式支持类似的功能，但Javascript无法用隐式初始值包装对象。Javascript中未设置属性的默认值是<code>undefined</code>。但 Proxy 可以改变这种情况。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">withZeroValue</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> zeroValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>prop <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token operator">?</span> obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token punctuation">:</span> zeroValue
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>函数<code>withZeroValue</code> 用来包装目标对象。 如果设置了属性，则返回属性值。 否则，它返回一个默认的**“零值”**。</p> <p>从技术上讲，这种方法也不是隐含的，但如果我们扩展<code>withZeroValue</code>，以Boolean (<code>false</code>), Number (<code>0</code>), String (<code>&quot;&quot;</code>), Object (<code>{}</code>)，Array (<code>[]</code>)等对应的零值，则可能是隐含的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> pos <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  y<span class="token punctuation">:</span> <span class="token number">19</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token comment">// 4, 19, undefined</span>

pos <span class="token operator">=</span> <span class="token function">withZeroValue</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token comment">// 4, 19, 0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>此功能可能有用的一个地方是坐标系。 绘图库可以基于数据的形状自动支持2D和3D渲染。 不是创建两个单独的模型，而是始终将<code>z</code>默认为 <code>0</code> 而不是<code>undefined</code>，这可能是有意义的。</p> <h2 id="负索引数组-2"><a href="#负索引数组-2" class="header-anchor">#</a> 负索引数组</h2> <p>在JS中获取数组中的最后一个元素方式通过写的很冗长且重复，也容易出错。 这就是为什么有一个TC39提案定义了一个便利属性<code>Array.lastItem</code>来获取和设置最后一个元素。</p> <p>其他语言，如Python和Ruby，使用负组索引更容易访问最后面的元素。例如，可以简单地使用<code>arr[-1]</code>替代<code>arr[arr.length-1]</code>访问最后一个元素。</p> <p>使用 Proxy 也可以在 Javascript 中使用负索引。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">negativeArray</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">els</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>els<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> propKey<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token operator">+</span>propKey <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">String</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token operator">+</span>propKey<span class="token punctuation">)</span> <span class="token punctuation">:</span> propKey<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>一个重要的注意事项是包含<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/get" target="_blank" rel="noopener noreferrer">handler.get<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的陷阱字符串化所有属性。 对于数组访问，我们需要将属性名称强制转换为<code>Numbers</code>，这样就可以使用一元加运算符简洁地完成。</p> <p>现在<code>[-1]</code>访问最后一个元素，<code>[-2]</code>访问倒数第二个元素，以此类推。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> unicorn <span class="token operator">=</span> <span class="token function">negativeArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'🐴'</span><span class="token punctuation">,</span> <span class="token string">'🎂'</span><span class="token punctuation">,</span> <span class="token string">'🌈'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

unicorn<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// '🌈'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="隐藏属性-2"><a href="#隐藏属性-2" class="header-anchor">#</a> 隐藏属性</h2> <p>众所周知 JS 没有私有属性。 <code>Symbol</code>最初是为了<a href="https://codeburst.io/a-practical-guide-to-es6-symbol-3fc90117c7ac" target="_blank" rel="noopener noreferrer">启用私有属性而引入的<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，但后来使用像<code>Object.getOwnPropertySymbols</code>这样的反射方法进行了淡化，这使得它们可以被公开发现。</p> <p>长期以来的惯例是将私有属性命名为前下划线<code>_</code>，有效地标记它们“不要访问”。<code>Prox</code> 提供了一种稍微更好的方法来屏蔽这些属性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> hide <span class="token operator">=</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> prefix <span class="token operator">=</span> <span class="token string">'_'</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">has</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">!</span>prop<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> prop <span class="token keyword">in</span> obj<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">ownKeys</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">prop</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> prop <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">||</span> <span class="token operator">!</span>prop<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> rec</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>prop <span class="token keyword">in</span> rec<span class="token punctuation">)</span> <span class="token operator">?</span> obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>hide</code>函数包装目标对象，并使得从<code>in</code>运算符和<code>Object.getOwnPropertyNames</code>等方法无法访问带有下划线的属性。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> userData <span class="token operator">=</span> <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  firstName<span class="token punctuation">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span>
  mediumHandle<span class="token punctuation">:</span> <span class="token string">'@tbarrasso'</span><span class="token punctuation">,</span>
  _favoriteRapper<span class="token punctuation">:</span> <span class="token string">'Drake'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

userData<span class="token punctuation">.</span>_favoriteRapper        <span class="token comment">// undefined</span>
<span class="token punctuation">(</span><span class="token string">'_favoriteRapper'</span> <span class="token keyword">in</span> userData<span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>更完整的实现还包括诸如<code>deleteProperty</code>和<code>defineProperty</code>之类的陷阱。 除了闭包之外，这可能是最接近真正私有属性的方法，因为它们无法通过枚举，克隆，访问或修改来访问。</p> <p><img src="https://segmentfault.com/img/bVbuSTv?w=975&amp;h=62" alt="clipboard.png"></p> <p>但是，它们在开发控制台中可见。 只有闭包才能免于这种命运。</p> <h2 id="缓存-2"><a href="#缓存-2" class="header-anchor">#</a> 缓存</h2> <p>在客户端和服务器之间同步状态时遇到困难并不罕见。数据可能会随着时间的推移而发生变化，很难确切地知道何时重新同步的逻辑。</p> <p><code>Proxy</code>启用了一种新方法：根据需要将对象包装为无效（和重新同步）属性。 所有访问属性的尝试都首先检查缓存策略，该策略决定返回当前在内存中的内容还是采取其他一些操作。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">ephemeral</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> ttl <span class="token operator">=</span> <span class="token number">60</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token constant">CREATED_AT</span> <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">isExpired</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token constant">CREATED_AT</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>ttl <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">isExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token punctuation">:</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这个函数过于简化了:它使对象上的所有属性在一段时间后都无法访问。然而，将此方法扩展为根据每个属性设置生存时间(TTL)，并在一定的持续时间或访问次数之后更新它并不困难。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> bankAccount <span class="token operator">=</span> <span class="token function">ephemeral</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  balance<span class="token punctuation">:</span> <span class="token number">14.93</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bankAccount<span class="token punctuation">.</span>balance<span class="token punctuation">)</span>    <span class="token comment">// 14.93</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bankAccount<span class="token punctuation">.</span>balance<span class="token punctuation">)</span>  <span class="token comment">// undefined</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这个示例简单地使银行帐户余额在10秒后无法访问。</p> <h2 id="枚举和只读视图-2"><a href="#枚举和只读视图-2" class="header-anchor">#</a> 枚举和只读视图</h2> <p>这些例子来自<code>Csaba Hellinge 关于[代理用例][23]和[Mozilla黑客][24]的文章。方法是包装一个对象以防止扩展或修改。虽然</code>object.freeze`现在提供了将对象渲染为只读的功能，但是可以对这种方法进行扩展，以便访问不存在属性的枚举对象能更好地处理抛出错误。</p> <h4 id="只读视图-2"><a href="#只读视图-2" class="header-anchor">#</a> <strong>只读视图</strong></h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">NOPE</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Can't modify read-only view&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token constant">NOPE_HANDLER</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token constant">NOPE</span><span class="token punctuation">,</span>
  defineProperty<span class="token punctuation">:</span> <span class="token constant">NOPE</span><span class="token punctuation">,</span>
  deleteProperty<span class="token punctuation">:</span> <span class="token constant">NOPE</span><span class="token punctuation">,</span>
  preventExtensions<span class="token punctuation">:</span> <span class="token constant">NOPE</span><span class="token punctuation">,</span>
  setPrototypeOf<span class="token punctuation">:</span> <span class="token constant">NOPE</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">readOnlyView</span> <span class="token operator">=</span> <span class="token parameter">target</span> <span class="token operator">=&gt;</span>
  <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token constant">NOPE_HANDLER</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="枚举视图-2"><a href="#枚举视图-2" class="header-anchor">#</a> <strong>枚举视图</strong></h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">createEnum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">readOnlyView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Unknown prop &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prop<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>现在我们可以创建一个<code>Object</code>，如果尝试访问不存在的属性现在不是返回<code>undefined</code>，而是会抛出异常。 这使得在早期捕获和解决问题变得更加容易。</p> <p>我们的<code>enum</code>示例也是代理上的代理的第一个示例，它确认代理是另一个代理的有效目标对象。这通过组合代理功能促进了代码重用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token constant">SHIRT_SIZES</span> <span class="token operator">=</span> <span class="token function">createEnum</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token constant">S</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token constant">M</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
  <span class="token constant">L</span><span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token constant">SHIRT_SIZES</span><span class="token punctuation">.</span><span class="token constant">S</span> <span class="token comment">// 10</span>
<span class="token constant">SHIRT_SIZES</span><span class="token punctuation">.</span><span class="token constant">S</span> <span class="token operator">=</span> <span class="token number">15</span>

<span class="token comment">// Uncaught Error: Can't modify read-only view</span>

<span class="token constant">SHIRT_SIZES</span><span class="token punctuation">.</span><span class="token constant">XL</span>

<span class="token comment">// Uncaught ReferenceError: Unknown prop &quot;XL&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这种方法可以进一步扩展，包括模拟方法<code>nameOf</code>，它返回给定<code>enum</code>值的属性名，模仿Javascript等语言中的行为。</p> <p>虽然其他框架和语言超集(比如TypeScript)提供<code>enum</code>类型，但是这个解决方案的独特之处在于，它使用普通Javascript，而不使用特殊的构建工具或转置器。</p> <h2 id="运算符重载-2"><a href="#运算符重载-2" class="header-anchor">#</a> 运算符重载</h2> <p>也许从语法上讲，最吸引人的 <code>Proxy</code> 用例是重载操作符的能力，比如使用<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/has" target="_blank" rel="noopener noreferrer">handler.has<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/in" target="_blank" rel="noopener noreferrer">in<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>操作符。</p> <p><code>in</code>操作符用于检查指定的属性是否位于指定的对象或其原型链中。但它也是语法上最优雅的重载操作符。这个例子定义了一个连续<code>range</code>函数来比较数字。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">range</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">has</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">+</span>prop <span class="token operator">&gt;=</span> min <span class="token operator">&amp;&amp;</span> <span class="token operator">+</span>prop <span class="token operator">&lt;=</span> max<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>与Python不同，Python使用生成器与有限的整数序列进行比较，这种方法支持十进制比较，可以扩展为支持其他数值范围。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">X</span> <span class="token operator">=</span> <span class="token number">10.5</span>
<span class="token keyword">const</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token constant">X</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">X</span> <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// true</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

nums<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> n <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 5]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>尽管这个用例不能解决复杂的问题，但它确实提供了干净、可读和可重用的代码。</p> <p>除了<code>in</code>运算符，我们还可以重载<code>delete</code>和<code>new</code>。</p> <h2 id="cookie对象-2"><a href="#cookie对象-2" class="header-anchor">#</a> cookie对象</h2> <p>如果你曾经与<code>cookie</code>进行交互，那么必须处理<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie" target="_blank" rel="noopener noreferrer">document.cookie<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 这是一个不寻常的API，因为API是一个<code>String</code>，它读出所有<code>cookie</code>，以<strong>分号分隔</strong>。</p> <p><code>document.cookie</code>是一个看起来像这样的字符串：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>_octo<span class="token operator">=</span><span class="token constant">GH1</span><span class="token number">.2</span><span class="token number">.2591</span><span class="token number">.47507</span><span class="token punctuation">;</span> _ga<span class="token operator">=</span><span class="token constant">GA1</span><span class="token number">.1</span><span class="token number">.62208</span><span class="token number">.4087</span><span class="token punctuation">;</span> has_recent_activity<span class="token operator">=</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>简而言之，处理<code>document.cookie</code>比较麻烦且容易出错。 一种方法是使用<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie/Simple_document.cookie_framework" target="_blank" rel="noopener noreferrer">简单的cookie框架<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，可以适用于使用 Proxy。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getCookieObject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cookies <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cks<span class="token punctuation">,</span> ck</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">[</span>ck<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> ck<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span> ck<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>ck<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>cks<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">setCookie</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">deleteCookie</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=; expires=Thu, 01 Jan 1970 00:00:01 GMT;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>cookies<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token function">setCookie</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">,</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function-variable function">deleteProperty</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token function">deleteCookie</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">,</span> Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>此函数返回一个键值对对象，但代理对<code>document.cookie</code>进行持久性的所有更改。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> docCookies <span class="token operator">=</span> <span class="token function">getCookieObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

docCookies<span class="token punctuation">.</span>has_recent_activity              <span class="token comment">// &quot;1&quot;</span>
docCookies<span class="token punctuation">.</span>has_recent_activity <span class="token operator">=</span> <span class="token string">&quot;2&quot;</span>        <span class="token comment">// &quot;2&quot;</span>
<span class="token keyword">delete</span> docCookies2<span class="token punctuation">[</span><span class="token string">&quot;has_recent_activity&quot;</span><span class="token punctuation">]</span>   <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在11行代码中，修改<code>cookie</code>提供了更好的交互，尽管在生产环境中还需要诸如字符串规范化之类的附加功能。</p> <p>细节决定成败，Proxy 也不例外。</p> <h2 id="polyfill-2"><a href="#polyfill-2" class="header-anchor">#</a> Polyfill</h2> <p>在撰写本文时(2019年5月)，Proxy 没有<strong>完整的 polyfill</strong>。然而，有一个由谷歌编写的 <a href="https://github.com/GoogleChrome/proxy-polyfill" target="_blank" rel="noopener noreferrer">partial polyfill for Proxy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，它支持<code>get</code>、<code>set</code>、<code>apply</code>和<code>construct trap</code>，并适用于IE9+。</p> <h4 id="它是-proxy-吗？-2"><a href="#它是-proxy-吗？-2" class="header-anchor">#</a> 它是 Proxy 吗？</h4> <blockquote><p>确定一个对象是否是代理是不可能的</p></blockquote> <p>根据Javascript语言规范，无法确定对象是否是代理。 但是，在 Node 10+上，可以使用<a href="https://nodejs.org/api/util.html#util_util_types_isproxy_value" target="_blank" rel="noopener noreferrer">util.types.isProxy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>方法。</p> <h4 id="目标是什么？-2"><a href="#目标是什么？-2" class="header-anchor">#</a> 目标是什么？</h4> <p>给定一个代理对象，就不可能获得或更改目标对象。也不可能获取或修改处理程序对象。</p> <p>最近似的是Ben Nadel的文章<a href="https://www.bennadel.com/blog/3262-using-proxy-objects-to-dynamically-change-the-this-binding-within-a-generator-in-node-js.htm" target="_blank" rel="noopener noreferrer">Using Proxy to Dynamically Change THIS Binding<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，它使用一个空对象作为<code>Proxy</code>目标和闭包来巧妙地重新分配对象的<code>Proxy</code>操作。</p> <h4 id="proxy-原语-2"><a href="#proxy-原语-2" class="header-anchor">#</a> Proxy 原语</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token string">&quot;To be, or not to be...&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// TypeError: Cannot create proxy with a non-object as target or handler</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>不幸的是，Proxy的一个限制是目标必须是Object。 这意味着我们不能直接使用像String这样的原语。 😞</p> <h4 id="性能-2"><a href="#性能-2" class="header-anchor">#</a> 性能</h4> <p>Proxy的一个主要缺点是性能。 因浏览器和使用而异，但是对于性能有要求的代码来说，代理不是最好的方法。 当然，可以衡量影响并确定代理的优势是否超过对性能的影响。</p> <h2 id="为什么要使用-proxy？-2"><a href="#为什么要使用-proxy？-2" class="header-anchor">#</a> 为什么要使用 Proxy？</h2> <p>Proxy 提供虚拟化接口来控制任何目标 Object的行为。 这样做可以在简单性和实用性之间取得平衡，而不会牺牲兼容性。</p> <p>也许使用<code>Proxy</code>的最令人信服的理由是，上面的许多示例只有几行，并且可以轻松组合以创建复杂的功能。 最后一个例子，我们可以从几个用例中组合函数来创建一个只读<code>cookie</code>对象，该对象返回不存在或“私有”隐藏cookie的默认值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// document.cookie = &quot;_octo=GH1.2.2591.47507; _ga=GA1.1.62208.4087; has_recent_activity=1&quot;</span>

<span class="token keyword">let</span> docCookies <span class="token operator">=</span> <span class="token function">withZeroValue</span><span class="token punctuation">(</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token function">readOnlyView</span><span class="token punctuation">(</span><span class="token function">getCookieObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Cookie not found&quot;</span><span class="token punctuation">)</span>

docCookies<span class="token punctuation">.</span>has_recent_activity  <span class="token comment">// &quot;1&quot;</span>
docCookies<span class="token punctuation">.</span>nonExistentCookie    <span class="token comment">// &quot;Cookie not found&quot;</span>
docCookies<span class="token punctuation">.</span>_ga                  <span class="token comment">// &quot;Cookie not found&quot;</span>
docCookies<span class="token punctuation">.</span>newCookie <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span>      <span class="token comment">// Uncaught Error: Can't modify read-only view</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>我希望这些例子已经表明，对于Javascript中的小众元编程来说，代理不仅仅是一个深奥的特性。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/md/frame/Vue/vue.html" class="prev">1.Vue集合</a></span> <span class="next"><a href="/md/frame/Vue/Vue性能优化.html">3.Vue性能优化</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.46fd8109.js" defer></script><script src="/assets/js/2.4e55561f.js" defer></script><script src="/assets/js/72.61d5dbd1.js" defer></script><script src="/assets/js/14.376a0de1.js" defer></script>
  </body>
</html>
