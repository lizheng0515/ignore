<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>文章相关资料 | 前端知识</title>
    <meta name="description" content="查缺补漏，厚积薄发">
    <link rel="icon" href="/ignore/images/favicon.ico">
  <link rel="manifest" href="/ignore/manifest.json">
  <link rel="stylesheet" href="/ignore/css/style.css">
    
    <link rel="preload" href="/ignore/assets/css/0.styles.af272f0a.css" as="style"><link rel="preload" href="/ignore/assets/js/app.ae63de62.js" as="script"><link rel="preload" href="/ignore/assets/js/2.8a6dc2e3.js" as="script"><link rel="preload" href="/ignore/assets/js/42.e2364288.js" as="script"><link rel="prefetch" href="/ignore/assets/js/10.8ba3da94.js"><link rel="prefetch" href="/ignore/assets/js/11.6d32525f.js"><link rel="prefetch" href="/ignore/assets/js/12.70cbde5e.js"><link rel="prefetch" href="/ignore/assets/js/13.2199ffb2.js"><link rel="prefetch" href="/ignore/assets/js/14.0941ce66.js"><link rel="prefetch" href="/ignore/assets/js/15.e8c6b849.js"><link rel="prefetch" href="/ignore/assets/js/16.63005794.js"><link rel="prefetch" href="/ignore/assets/js/17.38bf4b2d.js"><link rel="prefetch" href="/ignore/assets/js/18.7cfdfd39.js"><link rel="prefetch" href="/ignore/assets/js/19.79e6480d.js"><link rel="prefetch" href="/ignore/assets/js/20.ce49bf98.js"><link rel="prefetch" href="/ignore/assets/js/21.a1abce40.js"><link rel="prefetch" href="/ignore/assets/js/22.fcbcd29a.js"><link rel="prefetch" href="/ignore/assets/js/23.11659f11.js"><link rel="prefetch" href="/ignore/assets/js/24.71b9f548.js"><link rel="prefetch" href="/ignore/assets/js/25.40660b8d.js"><link rel="prefetch" href="/ignore/assets/js/26.2e490d8f.js"><link rel="prefetch" href="/ignore/assets/js/27.379adacb.js"><link rel="prefetch" href="/ignore/assets/js/28.2e613321.js"><link rel="prefetch" href="/ignore/assets/js/29.da330e76.js"><link rel="prefetch" href="/ignore/assets/js/3.e108419e.js"><link rel="prefetch" href="/ignore/assets/js/30.ce0912be.js"><link rel="prefetch" href="/ignore/assets/js/31.26b19e98.js"><link rel="prefetch" href="/ignore/assets/js/32.c531a999.js"><link rel="prefetch" href="/ignore/assets/js/33.53a2f990.js"><link rel="prefetch" href="/ignore/assets/js/34.a37034ac.js"><link rel="prefetch" href="/ignore/assets/js/35.2879a806.js"><link rel="prefetch" href="/ignore/assets/js/36.caf1f969.js"><link rel="prefetch" href="/ignore/assets/js/37.cfa6b9eb.js"><link rel="prefetch" href="/ignore/assets/js/38.657869a7.js"><link rel="prefetch" href="/ignore/assets/js/39.b7da0da6.js"><link rel="prefetch" href="/ignore/assets/js/4.d1c75c66.js"><link rel="prefetch" href="/ignore/assets/js/40.4870d267.js"><link rel="prefetch" href="/ignore/assets/js/41.e5984042.js"><link rel="prefetch" href="/ignore/assets/js/43.234ca59b.js"><link rel="prefetch" href="/ignore/assets/js/44.3af77e17.js"><link rel="prefetch" href="/ignore/assets/js/45.39ec0b64.js"><link rel="prefetch" href="/ignore/assets/js/46.7328d8cb.js"><link rel="prefetch" href="/ignore/assets/js/47.863f032d.js"><link rel="prefetch" href="/ignore/assets/js/48.de3f2e1c.js"><link rel="prefetch" href="/ignore/assets/js/49.5992f480.js"><link rel="prefetch" href="/ignore/assets/js/5.29b118d6.js"><link rel="prefetch" href="/ignore/assets/js/50.25535208.js"><link rel="prefetch" href="/ignore/assets/js/51.22f8ab6a.js"><link rel="prefetch" href="/ignore/assets/js/52.985b8c7a.js"><link rel="prefetch" href="/ignore/assets/js/53.e2e85bac.js"><link rel="prefetch" href="/ignore/assets/js/54.e678090d.js"><link rel="prefetch" href="/ignore/assets/js/55.c85fa7de.js"><link rel="prefetch" href="/ignore/assets/js/56.6022f7a5.js"><link rel="prefetch" href="/ignore/assets/js/57.1d3c4c18.js"><link rel="prefetch" href="/ignore/assets/js/58.25b36258.js"><link rel="prefetch" href="/ignore/assets/js/59.845a3460.js"><link rel="prefetch" href="/ignore/assets/js/6.9f09646a.js"><link rel="prefetch" href="/ignore/assets/js/60.5ff535ce.js"><link rel="prefetch" href="/ignore/assets/js/61.ea764213.js"><link rel="prefetch" href="/ignore/assets/js/62.b262201f.js"><link rel="prefetch" href="/ignore/assets/js/63.3443883e.js"><link rel="prefetch" href="/ignore/assets/js/64.b1dffc47.js"><link rel="prefetch" href="/ignore/assets/js/65.db2b3af3.js"><link rel="prefetch" href="/ignore/assets/js/66.2706fdf2.js"><link rel="prefetch" href="/ignore/assets/js/67.b0a3cb2f.js"><link rel="prefetch" href="/ignore/assets/js/68.2cd89efe.js"><link rel="prefetch" href="/ignore/assets/js/69.de33350e.js"><link rel="prefetch" href="/ignore/assets/js/7.9dc13833.js"><link rel="prefetch" href="/ignore/assets/js/70.7bc7f071.js"><link rel="prefetch" href="/ignore/assets/js/71.37f11d96.js"><link rel="prefetch" href="/ignore/assets/js/72.a04444b8.js"><link rel="prefetch" href="/ignore/assets/js/73.27c49676.js"><link rel="prefetch" href="/ignore/assets/js/74.dbabf564.js"><link rel="prefetch" href="/ignore/assets/js/75.3284bee8.js"><link rel="prefetch" href="/ignore/assets/js/76.59f6e624.js"><link rel="prefetch" href="/ignore/assets/js/77.46149523.js"><link rel="prefetch" href="/ignore/assets/js/78.3f459f71.js"><link rel="prefetch" href="/ignore/assets/js/79.804fd229.js"><link rel="prefetch" href="/ignore/assets/js/8.210c94c0.js"><link rel="prefetch" href="/ignore/assets/js/80.66f21a4d.js"><link rel="prefetch" href="/ignore/assets/js/81.b2ed4a12.js"><link rel="prefetch" href="/ignore/assets/js/82.4e5c150a.js"><link rel="prefetch" href="/ignore/assets/js/83.9d72408b.js"><link rel="prefetch" href="/ignore/assets/js/84.5888e60e.js"><link rel="prefetch" href="/ignore/assets/js/85.4ae541ca.js"><link rel="prefetch" href="/ignore/assets/js/86.82a73d55.js"><link rel="prefetch" href="/ignore/assets/js/87.c117ac29.js"><link rel="prefetch" href="/ignore/assets/js/88.491214d5.js"><link rel="prefetch" href="/ignore/assets/js/89.6b647d6a.js"><link rel="prefetch" href="/ignore/assets/js/9.524ed2fa.js"><link rel="prefetch" href="/ignore/assets/js/90.23492b12.js"><link rel="prefetch" href="/ignore/assets/js/91.d03800ac.js"><link rel="prefetch" href="/ignore/assets/js/92.422d52f2.js"><link rel="prefetch" href="/ignore/assets/js/93.0de7e4d3.js"><link rel="prefetch" href="/ignore/assets/js/94.44f449b4.js"><link rel="prefetch" href="/ignore/assets/js/95.99a8ec66.js">
    <link rel="stylesheet" href="/ignore/assets/css/0.styles.af272f0a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ignore/" class="home-link router-link-active"><!----> <span class="site-name">前端知识</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ignore/md/resource/resource.html" class="nav-link">资源工具</a></div><div class="nav-item"><a href="/ignore/md/introduction/introduction.html" class="nav-link">导读</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Javascript" class="dropdown-title"><span class="title">Javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ignore/md/js/jsBasic/" class="nav-link">JavaScript基础</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/js/jsHigh/" class="nav-link">JavaScript进阶</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/js/es6/" class="nav-link">ECMAScript 6</a></li><li class="dropdown-item"><h4>JS书籍</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ignore/md/js/book/你不知道的javascript上.html" class="nav-link">你不知道的JavaScript(上)</a></li><li class="dropdown-subitem"><a href="/ignore/md/js/book/你不知道的javascript中.html" class="nav-link">你不知道的JavaScript(中下)</a></li><li class="dropdown-subitem"><a href="/ignore/md/js/book/es6.html" class="nav-link">深入理解ES6</a></li><li class="dropdown-subitem"><a href="/ignore/md/js/book/algorithm.html" class="nav-link">JavaScript数据结构和算法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端概括" class="dropdown-title"><span class="title">前端概括</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ignore/md/webBasics/CSS/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/webBasics/HTML5/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/webBasics/Node/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/webBasics/property/" class="nav-link">性能/监控</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/webBasics/allPath/" class="nav-link">全链路开发</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/webBasics/scope/" class="nav-link">领域分支</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架/库" class="dropdown-title"><span class="title">框架/库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ignore/md/frame/Vue/" class="nav-link">Vue.js</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/frame/React/" class="nav-link router-link-active">React</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/frame/Angular/" class="nav-link">Angular</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/frame/jQuery/" class="nav-link">jQuery</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/frame/Class/" class="nav-link">类库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="日积月累" class="dropdown-title"><span class="title">日积月累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ignore/md/codeBlock/module/" class="nav-link">代码模块</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/codeBlock/week/" class="nav-link">每周汇总</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/codeBlock/jobInterview/" class="nav-link">面试收集</a></li><li class="dropdown-item"><h4>方法论</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ignore/md/codeBlock/methodology/1.html" class="nav-link">编程思想</a></li><li class="dropdown-subitem"><a href="/ignore/md/codeBlock/methodology/2.html" class="nav-link">开发原则</a></li><li class="dropdown-subitem"><a href="/ignore/md/codeBlock/methodology/3.html" class="nav-link">开发流程</a></li><li class="dropdown-subitem"><a href="/ignore/md/codeBlock/methodology/6.html" class="nav-link">代码规范</a></li><li class="dropdown-subitem"><a href="/ignore/md/codeBlock/methodology/4.html" class="nav-link">设计模式</a></li><li class="dropdown-subitem"><a href="/ignore/md/codeBlock/methodology/5.html" class="nav-link">开源协议</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/ignore/md/about/" class="nav-link">关于我</a></div> <a href="https://github.com/lizheng0515/ignore/issues" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ignore/md/resource/resource.html" class="nav-link">资源工具</a></div><div class="nav-item"><a href="/ignore/md/introduction/introduction.html" class="nav-link">导读</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Javascript" class="dropdown-title"><span class="title">Javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ignore/md/js/jsBasic/" class="nav-link">JavaScript基础</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/js/jsHigh/" class="nav-link">JavaScript进阶</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/js/es6/" class="nav-link">ECMAScript 6</a></li><li class="dropdown-item"><h4>JS书籍</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ignore/md/js/book/你不知道的javascript上.html" class="nav-link">你不知道的JavaScript(上)</a></li><li class="dropdown-subitem"><a href="/ignore/md/js/book/你不知道的javascript中.html" class="nav-link">你不知道的JavaScript(中下)</a></li><li class="dropdown-subitem"><a href="/ignore/md/js/book/es6.html" class="nav-link">深入理解ES6</a></li><li class="dropdown-subitem"><a href="/ignore/md/js/book/algorithm.html" class="nav-link">JavaScript数据结构和算法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端概括" class="dropdown-title"><span class="title">前端概括</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ignore/md/webBasics/CSS/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/webBasics/HTML5/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/webBasics/Node/" class="nav-link">Node.js</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/webBasics/property/" class="nav-link">性能/监控</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/webBasics/allPath/" class="nav-link">全链路开发</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/webBasics/scope/" class="nav-link">领域分支</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架/库" class="dropdown-title"><span class="title">框架/库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ignore/md/frame/Vue/" class="nav-link">Vue.js</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/frame/React/" class="nav-link router-link-active">React</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/frame/Angular/" class="nav-link">Angular</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/frame/jQuery/" class="nav-link">jQuery</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/frame/Class/" class="nav-link">类库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="日积月累" class="dropdown-title"><span class="title">日积月累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ignore/md/codeBlock/module/" class="nav-link">代码模块</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/codeBlock/week/" class="nav-link">每周汇总</a></li><li class="dropdown-item"><!----> <a href="/ignore/md/codeBlock/jobInterview/" class="nav-link">面试收集</a></li><li class="dropdown-item"><h4>方法论</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ignore/md/codeBlock/methodology/1.html" class="nav-link">编程思想</a></li><li class="dropdown-subitem"><a href="/ignore/md/codeBlock/methodology/2.html" class="nav-link">开发原则</a></li><li class="dropdown-subitem"><a href="/ignore/md/codeBlock/methodology/3.html" class="nav-link">开发流程</a></li><li class="dropdown-subitem"><a href="/ignore/md/codeBlock/methodology/6.html" class="nav-link">代码规范</a></li><li class="dropdown-subitem"><a href="/ignore/md/codeBlock/methodology/4.html" class="nav-link">设计模式</a></li><li class="dropdown-subitem"><a href="/ignore/md/codeBlock/methodology/5.html" class="nav-link">开源协议</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/ignore/md/about/" class="nav-link">关于我</a></div> <a href="https://github.com/lizheng0515/ignore/issues" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ignore/md/frame/React/热身篇.html" class="sidebar-link">热身篇</a></li><li><a href="/ignore/md/frame/React/组件更新流程一（调度任务）.html" class="sidebar-link">组件更新流程一（调度任务）</a></li><li><a href="/ignore/md/frame/React/组件更新流程二（diff 策略）.html" class="sidebar-link">组件更新流程二（diff 策略）</a></li><li><a href="/ignore/md/frame/React/调度原理.html" class="active sidebar-link">调度原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ignore/md/frame/React/调度原理.html#文章相关资料" class="sidebar-link">文章相关资料</a></li><li class="sidebar-sub-header"><a href="/ignore/md/frame/React/调度原理.html#为什么需要调度？" class="sidebar-link">为什么需要调度？</a></li><li class="sidebar-sub-header"><a href="/ignore/md/frame/React/调度原理.html#react-如何实现调度" class="sidebar-link">React 如何实现调度</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ignore/md/frame/React/调度原理.html#expriationtime" class="sidebar-link">expriationTime</a></li><li class="sidebar-sub-header"><a href="/ignore/md/frame/React/调度原理.html#requestidlecallback" class="sidebar-link">requestIdleCallback</a></li></ul></li><li class="sidebar-sub-header"><a href="/ignore/md/frame/React/调度原理.html#如何实现-requestidlecallback" class="sidebar-link">如何实现 requestIdleCallback</a></li><li class="sidebar-sub-header"><a href="/ignore/md/frame/React/调度原理.html#调度的流程" class="sidebar-link">调度的流程</a></li><li class="sidebar-sub-header"><a href="/ignore/md/frame/React/调度原理.html#调度不会仅仅只有-react-拥有" class="sidebar-link">调度不会仅仅只有 React 拥有</a></li><li class="sidebar-sub-header"><a href="/ignore/md/frame/React/调度原理.html#最后" class="sidebar-link">最后</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="文章相关资料"><a href="#文章相关资料" class="header-anchor">#</a> 文章相关资料</h2> <ul><li><a href="https://github.com/KieSun/react-interpretation" target="_blank" rel="noopener noreferrer">React 16.8.6 源码中文注释<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，如果你想读源码但是又怕看不懂的话，可以通过这个仓库来学习</li></ul> <h2 id="为什么需要调度？"><a href="#为什么需要调度？" class="header-anchor">#</a> 为什么需要调度？</h2> <p>大家都知道 JS 和渲染引擎是一个互斥关系。如果 JS 在执行代码，那么渲染引擎工作就会被停止。假如我们有一个很复杂的复合组件需要重新渲染，那么调用栈可能会很长</p> <p><img src="https://yck-1254263422.cos.ap-shanghai.myqcloud.com/blog/2019-06-04-155141.png" alt=""></p> <p>调用栈过长，再加上如果中间进行了复杂的操作，就可能导致长时间阻塞渲染引擎带来不好的用户体验，调度就是来解决这个问题的。</p> <p>React 会根据任务的优先级去分配各自的 <code>expirationTime</code>，在过期时间到来之前先去处理更高优先级的任务，并且高优先级的任务还可以打断低优先级的任务（因此会造成某些生命周期函数多次被执行），从而实现在不影响用户体验的情况下去分段计算更新（也就是时间分片）。</p> <p><img src="https://yck-1254263422.cos.ap-shanghai.myqcloud.com/blog/2019-06-04-155143.png" alt=""></p> <h2 id="react-如何实现调度"><a href="#react-如何实现调度" class="header-anchor">#</a> React 如何实现调度</h2> <p>React 实现调度主要靠两块内容：</p> <ol><li>计算任务的 expriationTime</li> <li>实现 requestIdleCallback 的 polyfill 版本</li></ol> <p>接下来就让笔者为大家一一介绍着两块内容。</p> <h3 id="expriationtime"><a href="#expriationtime" class="header-anchor">#</a> expriationTime</h3> <p>expriationTime 在前文简略的介绍过它的作用，这个时间可以帮助我们对比不同任务之间的优先级以及计算任务的 timeout。</p> <p>那么这个时间是如何计算出来的呢？</p> <p><img src="https://yck-1254263422.cos.ap-shanghai.myqcloud.com/blog/2019-06-04-155144.png" alt=""></p> <p>当前时间指的是 <code>performance.now()</code>，这个 API 会返回一个精确到毫秒级别的时间戳（当然也并不是高精度的），另外浏览器也并不是所有都兼容 <code>performance</code> API 的。如果使用 <code>Date.now()</code> 的话那么精度会更差，但是为了方便起见，我们这里统一把当前时间认为是 <code>performance.now()</code>。</p> <p>常量指的是根据不同优先级得出的一个数值，React 内部目前总共有五种优先级，分别为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> ImmediatePriority <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> UserBlockingPriority <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> NormalPriority <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> LowPriority <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> IdlePriority <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>它们各自的对应的数值都是不同的，具体的内容如下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> maxSigned31BitInt <span class="token operator">=</span> <span class="token number">1073741823</span><span class="token punctuation">;</span>

<span class="token comment">// Times out immediately</span>
<span class="token keyword">var</span> <span class="token constant">IMMEDIATE_PRIORITY_TIMEOUT</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// Eventually times out</span>
<span class="token keyword">var</span> <span class="token constant">USER_BLOCKING_PRIORITY</span> <span class="token operator">=</span> <span class="token number">250</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token constant">NORMAL_PRIORITY_TIMEOUT</span> <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token constant">LOW_PRIORITY_TIMEOUT</span> <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
<span class="token comment">// Never times out</span>
<span class="token keyword">var</span> <span class="token constant">IDLE_PRIORITY</span> <span class="token operator">=</span> maxSigned31BitInt<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>也就是说，假设当前时间为 5000 并且分别有两个优先级不同的任务要执行。前者属于 <code>ImmediatePriority</code>，后者属于 <code>UserBlockingPriority</code>，那么两个任务计算出来的时间分别为 <code>4999</code> 和 <code>5250</code>。通过这个时间可以比对大小得出谁的优先级高，也可以通过减去当前时间获取任务的 timeout。</p> <h3 id="requestidlecallback"><a href="#requestidlecallback" class="header-anchor">#</a> requestIdleCallback</h3> <p>说完了 <code>expriationTime</code>，接下来的主题就是实现 <code>requestIdleCallback</code> 了，我们首先来了解下该函数的作用</p> <p><img src="https://yck-1254263422.cos.ap-shanghai.myqcloud.com/blog/2019-06-04-155145.png" alt=""></p> <p>该函数的回调方法会在浏览器的空闲时期依次调用， 可以让我们在事件循环中执行一些任务，并且不会对像动画和用户交互这样延迟敏感的事件产生影响。</p> <p>在上图中我们也可以发现，该回调方法是在渲染以后才执行的。那么介绍完了函数的作用，接下来就来说说它的兼容性吧。</p> <p><img src="https://yck-1254263422.cos.ap-shanghai.myqcloud.com/blog/2019-06-04-155146.png" alt=""></p> <p>这个函数的兼容性并不是很好，并且它还有一个致命的缺陷：</p> <blockquote><p>requestIdleCallback is called only 20 times per second - Chrome on my 6x2 core Linux machine, it's not really useful for UI work.</p></blockquote> <p>也就是说 <code>requestIdleCallback</code> 只能一秒调用回调 20 次，这个完全满足不了现有的情况，由此 React 团队才打算自己实现这个函数。</p> <p>如果你想了解更多关于替换 <code>requestIdleCallback</code> 的内容，可以阅读 <a href="https://github.com/facebook/react/issues/13206#issuecomment-418923831" target="_blank" rel="noopener noreferrer">该 Issus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="如何实现-requestidlecallback"><a href="#如何实现-requestidlecallback" class="header-anchor">#</a> 如何实现 requestIdleCallback</h2> <p>实现 <code>requestIdleCallback</code> 函数的核心只有一点，<strong>如何多次在浏览器空闲时且是渲染后才调用回调方法？</strong></p> <p>说到多次执行，那么肯定得使用定时器了。在多种定时器中，唯有 <code>requestAnimationFrame</code> 具备一定的精确度，因此 <code>requestAnimationFrame</code> 就是当下实现 <code>requestIdleCallback</code> 的一个步骤。</p> <p><code>requestAnimationFrame</code> 的回调方法会在每次重绘前执行，另外它还存在一个瑕疵：页面处于后台时该回调函数不会执行，因此我们需要对于这种情况做个补救措施</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>rAFID <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">timestamp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// cancel the setTimeout</span>
	<span class="token function">localClearTimeout</span><span class="token punctuation">(</span>rAFTimeoutID<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">callback</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rAFTimeoutID <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 定时 100 毫秒是算是一个最佳实践</span>
	<span class="token function">localCancelAnimationFrame</span><span class="token punctuation">(</span>rAFID<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">callback</span><span class="token punctuation">(</span><span class="token function">getCurrentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>当 <code>requestAnimationFrame</code> 不执行时，会有 <code>setTimeout</code> 去补救，两个定时器内部可以互相取消对方。</p> <p>使用 <code>requestAnimationFrame</code> 只完成了多次执行这一步操作，接下来我们需要实现如何知道当前浏览器是否空闲呢？</p> <p><img src="https://yck-1254263422.cos.ap-shanghai.myqcloud.com/blog/2019-06-04-155147.png" alt=""></p> <p>大家都知道在一帧当中，浏览器可能会响应用户的交互事件、执行 JS、进行渲染的一系列计算绘制。假设当前我们的浏览器支持 1 秒 60 帧，那么也就是说一帧的时间为 16.6 毫秒。如果以上这些操作超过了 16.6 毫秒，那么就会导致渲染没有完成并出现掉帧的情况，继而影响用户体验；如果以上这些操作没有耗时 16.6 毫秒的话，那么我们就认为当下存在空闲时间让我们可以去执行任务。</p> <p>因此接下去我们需要计算出当前帧是否还有剩余时间让我们使用。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> frameDeadline <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">let</span> previousFrameTime <span class="token operator">=</span> <span class="token number">33</span>
<span class="token keyword">let</span> activeFrameTime <span class="token operator">=</span> <span class="token number">33</span>
<span class="token keyword">let</span> nextFrameTime <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> frameDeadline <span class="token operator">+</span> activeFrameTime
<span class="token keyword">if</span> <span class="token punctuation">(</span>
	nextFrameTime <span class="token operator">&lt;</span> activeFrameTime <span class="token operator">&amp;&amp;</span>
	previousFrameTime <span class="token operator">&lt;</span> activeFrameTime
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>nextFrameTime <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		nextFrameTime <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	activeFrameTime <span class="token operator">=</span>
		nextFrameTime <span class="token operator">&lt;</span> previousFrameTime <span class="token operator">?</span> previousFrameTime <span class="token punctuation">:</span> nextFrameTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	previousFrameTime <span class="token operator">=</span> nextFrameTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>以上这部分代码核心就是得出每一帧所耗时间及下一帧的时间。简单来说就是假设当前时间为 5000，浏览器支持 60 帧，那么 1 帧近似 16 毫秒，那么就会计算出下一帧时间为 5016。</p> <p>得出下一帧时间以后，我们只需对比当前时间是否小于下一帧时间即可，这样就能清楚地知道是否还有空闲时间去执行任务。</p> <p>那么最后一步操作就是如何在渲染以后才去执行任务。这里就需要用到事件循环的知识了</p> <p><img src="https://yck-1254263422.cos.ap-shanghai.myqcloud.com/blog/2019-06-04-155148.png" alt=""></p> <p>想必大家都知道微任务宏任务的区别，这里就不再赘述这部分的内容了。从上图中我们可以发现，在渲染以后只有宏任务是最先会被执行的，因此宏任务就是我们实现这一步的操作了。</p> <p>但是生成一个宏任务有很多种方式并且各自也有优先级，那么为了最快地执行任务，我们肯定得选择优先级高的方式。在这里我们选择了 <code>MessageChannel</code> 来完成这个任务，不选择 <code>setImmediate</code> 的原因是因为兼容性太差。</p> <p>到这里为止，<code>requestAnimationFrame</code> + 计算帧时间及下一帧时间 + <code>MessageChannel</code> 就是我们实现 <code>requestIdleCallback</code> 的三个关键点了。</p> <h2 id="调度的流程"><a href="#调度的流程" class="header-anchor">#</a> 调度的流程</h2> <p>上文说了这么多，这一小节我们将来梳理一遍调度的整个流程。</p> <ul><li>首先每个任务都会有各自的优先级，通过当前时间加上优先级所对应的常量我们可以计算出 <code>expriationTime</code>，<strong>高优先级的任务会打断低优先级任务</strong></li> <li>在调度之前，判断当前任务<strong>是否过期</strong>，过期的话无须调度，直接调用 <code>port.postMessage(undefined)</code>，这样就能在渲染后马上执行过期任务了</li> <li>如果任务没有过期，就通过 <code>requestAnimationFrame</code> 启动定时器，在重绘前调用回调方法</li> <li>在回调方法中我们首先需要<strong>计算每一帧的时间以及下一帧的时间</strong>，然后执行 <code>port.postMessage(undefined)</code></li> <li><code>channel.port1.onmessage</code> 会在渲染后被调用，在这个过程中我们首先需要去判断<strong>当前时间是否小于下一帧时间</strong>。如果小于的话就代表我们尚有空余时间去执行任务；如果大于的话就代表当前帧已经没有空闲时间了，这时候我们需要去判断是否有任务过期，<strong>过期的话不管三七二十一还是得去执行这个任务</strong>。如果没有过期的话，那就只能把这个任务丢到下一帧看能不能执行了</li></ul> <h2 id="调度不会仅仅只有-react-拥有"><a href="#调度不会仅仅只有-react-拥有" class="header-anchor">#</a> 调度不会仅仅只有 React 拥有</h2> <p>在未来，调度这个功能不会仅仅只有 React 才拥有。因为 React 已经尝试把调度这个模块单独抽离成一个库，这个库在未来能够被大家置入到自己的应用中去提高用户体验。</p> <p>并且社区也有提案，希望浏览器能自带这方面的功能，具体可以阅读 <a href="https://github.com/WICG/main-thread-scheduling" target="_blank" rel="noopener noreferrer">这个库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h2> <p>阅读源码是一个很枯燥的过程，但是收益也是巨大的。</p> <p>另外写这系列是个很耗时的工程，需要维护代码注释，还得把文章写得尽量让读者看懂，最后还得配上画图，如果你觉得文章看着还行，就请不要吝啬你的点赞。</p> <p>最后，觉得内容有帮助可以关注下我的公众号 「前端真好玩」咯，会有很多好东西等着你。</p> <p><img src="https://yck-1254263422.cos.ap-shanghai.myqcloud.com/blog/2019-06-04-155148.jpg" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ignore/md/frame/React/组件更新流程二（diff 策略）.html" class="prev">组件更新流程二（diff 策略）</a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/ignore/assets/js/app.ae63de62.js" defer></script><script src="/ignore/assets/js/2.8a6dc2e3.js" defer></script><script src="/ignore/assets/js/42.e2364288.js" defer></script>
  </body>
</html>
